{"filter":false,"title":"script.min.js","tooltip":"/5-pwd/scripts/script.min.js","undoManager":{"mark":16,"position":16,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":7146},"action":"insert","lines":["\"use strict\";function AjaxCon(e,t,n,i){var r=4,a=this.getXHR();a.onreadystatechange=function(){a.readyState===r&&(a.status>=200&&a.status<300||304===a.status||400===a.status?t(a.responseText):console.log(\"Läsfel, status: \"+a.status))},\"get\"===n||\"GET\"===n?(a.open(\"get\",e,!0),a.send(null)):(a.open(\"POST\",e,!0),a.setRequestHeader(\"Content-Type\",\"application/json; charset=UTF-8\"),a.send(i)),this.abort=function(){a.abort()}}function AppLoader(e){var t=document.createElement(\"div\");t.classList.add(\"AppLoader\");var n=document.createElement(\"h1\");n.innerHTML=e,t.appendChild(n);var i=document.querySelector(\"body\");i.appendChild(t);var r=document.createElement(\"div\");r.classList.add(\"container\"),t.appendChild(r);var a=document.createElement(\"div\");a.classList.add(\"progress\"),r.appendChild(a),setTimeout(function(){a.classList.add(\"loading\"),setTimeout(function(){i.removeChild(t)},1250)},200)}function Message(e,t,n){this.getText=function(){return e},this.setText=function(t){e=t},this.getDate=function(){return t},this.setDate=function(e){t=e},this.getAuthor=function(){return n},this.setAuthor=function(e){n=e}}function MessageBoard(e,t,n){this.WindowConstruct(\"Chat\",!1,e,t,n),this.title=\"Chat\",this.app.classList.add(\"labbymezzage\"),this.messages=[],this.imageLocation=\"images/chat\",this.timer=void 0;var i=this.getCookie();\"object\"==typeof i?(this.refreshRate=i[0],this.username=i[1],this.history=i[2]):(this.refreshRate=1e4,this.username=\"Anonymous\",this.history=20),this.connection=void 0,this.CreateHTMLLayout(),this.getMessagesFromServer()}function Desktop(e){this.windows=[],this.minimizedApps=0,this.element=document.getElementById(e),this.element.classList.add(\"desktop\"),this.navbar=document.createElement(\"nav\");var t=this,n=function(){var e=30*t.windows.length+30;return e/(window.innerWidth-200)>1?e-Math.floor(e/(window.innerWidth-200))*(window.innerWidth-200):30*t.windows.length+30},i=function(){var e=30*t.windows.length+30;return e/(window.innerHeight-300)>1?e-Math.floor(e/(window.innerHeight-300))*(window.innerHeight-300):30*t.windows.length+30};this.element.appendChild(this.navbar);var r=[[MemoryGame,\"images/appIcons/Memory_Large.png\",\"Memory\"],[Minesweeper,\"images/appIcons/Minesweeper_Large.png\",\"Minesweeper\"],[QuizWindow,\"images/appIcons/Quiz_Large.png\",\"Quiz\"],[QuoteWindow,\"images/appIcons/Quote_Large.png\",\"Quotes\"],[MessageBoard,\"images/appIcons/Chat_Large.png\",\"Chat\"],[RSSWindow,\"images/appIcons/RSS_Large.png\",\"RSS\"],[GalleryWindow,\"images/appIcons/Gallery_Large.png\",\"Gallery\"],[NoteWindow,\"images/appIcons/Note_Large.png\",\"Note\"]];r.forEach(function(e){var r=document.createElement(\"a\");r.href=\"#\",r.classList.add(\"appLauncher\"),r.onclick=function(r){r.preventDefault(),t.windows.push(new e[0](t,n(),i()))};var a=document.createElement(\"img\");a.src=e[1],r.appendChild(a);var s=document.createElement(\"span\");s.innerHTML=e[2],r.appendChild(s),t.element.appendChild(r)}),this.hideApp=function(e,n){t.navbar.classList.add(\"showNav\"),e=e.parentNode.parentNode,e.classList.add(\"hidden\"),t.minimizedApps++;var i=document.createElement(\"img\");i.src=n,i.className=\"minimizedWindow\",i.onclick=function(){e.classList.remove(\"hidden\"),t.navbar.removeChild(i),--t.minimizedApps<=0&&t.navbar.classList.remove(\"showNav\")},t.navbar.appendChild(i)}}function ImageWindow(e,t,n,i){var r=document.createElement(\"img\");r.src=e,this.WindowConstruct(\"Gallery\",!1,t,n,i),this.app.appendChild(r)}function GalleryWindow(e,t,n){this.WindowConstruct(\"Gallery\",!1,e,t,n),this.Url=\"http://homepage.lnu.se/staff/tstjo/labbyServer/imgviewer/\",this.thumbWidth=0,this.thumbHeight=0,this.timer=void 0,this.imageArr=void 0,this.app.classList.add(\"Gallery\"),this.OpenInNewWindow=function(i){new ImageWindow(i,e,t+5,n+5)},this.loadImages()}function MemoryGame(e,t,n){var i=2,r=4;this.WindowConstruct(\"Memory\",!1,e,t,n),this.app.classList.add(\"GameOn-Memory\"),this.imageLocation=\"images/memory/\",this.getRows=function(){return i},this.setRows=function(e){i=e},this.getCols=function(){return r},this.setCols=function(e){r=e},this.isActive=!1,this.flippedImage,this.pictureArray,this.structuredArray,this.flippedCards,this.turnCounter,this.resetGame([this.getRows(),this.getCols()])}function Minesweeper(e,t,n){this.difficulties=[[\"Beginner\",9],[\"Intermidiate\",15],[\"Expert\",20]],this.WindowConstruct(\"Minesweeper\",!1,e,t,n),this.app.classList.add(\"GameOn-Minesweeper\"),this.imagePrefix=\"images/minesweeper/\",this.GameWidth=9,this.PictureWidth=20,this.gameOver,this.board=[],this.numberOfMines,this.mines,this.turnedImages,this.markedImages,this.timer,this.clock,this.bombsCounter,this.startGame()}function NoteWindow(e,t,n){this.startHeight=300,this.startWidth=300,this.WindowConstruct(\"Note\",!0,e,t,n),this.render()}function QuizWindow(e,t,n){this.WindowConstruct(\"Quiz\",!1,e,t,n),this.app=this.app,this.nextURL,this.moreQuestions=!0,this.questionsArr,this.init()}function QuoteWindow(e,t,n){this.WindowConstruct(\"Quote\",!1,e,t,n),this.timer,this.connection,this.refreshRate=1e4,this.render()}function RSSWindow(e,t,n){this.startHeight=600,this.startWidth=300,this.WindowConstruct(\"RSS\",!0,e,t,n),this.feedUrl=\"http://www.dn.se/m/rss/senaste-nytt\",this.feed=void 0,this.timer=void 0,this.connection=void 0,this.refreshRate=6e5,this.reloadFeed(),this.render()}function Window(){this.dragY=0,this.dragX=0,this.dragging=!1,this.imageFolder=\"images/\"}AjaxCon.prototype.getXHR=function(){var e=null;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(t){throw new Error(\"No XHR object available\")}}return e},Message.prototype.getHTMLText=function(){return this.getText()},Message.prototype.getDateText=function(){var e=new Date,t=e-this.getDate(),n=Math.round(t/1e3),i=Math.floor(n/60),r=(Math.floor(i/60),e.getUTCDate()-this.getDate().getUTCDate()),a=e.getUTCMonth()-this.getDate().getUTCMonth(),s=this.getDate().getHours()+\":\"+(this.getDate().getMinutes()<10?\"0\":\"\")+this.getDate().getMinutes()+\":\"+(this.getDate().getSeconds()<10?\"0\":\"\")+this.getDate().getSeconds();return 60>n&&1>a?\"just now\":1==i&&0===a?i+\" minute ago\":60>i&&0===a?i+\" minutes ago\":1>r&&0===a?\"Today \"+s:2>r&&0===a?\"Yesterday \"+s:this.getDate().getUTCDate()+\"/\"+(this.getDate().getMonth()+1)+\"-\"+this.getDate().getFullYear()},MessageBoard.prototype=new Window,MessageBoard.prototype.constructor=MessageBoard,MessageBoard.prototype.ClearTimers=function(){clearInterval(this.timer),\"undefined\"!=typeof this.connection&&this.connection.abort()},MessageBoard.prototype.CreateHTMLLayout=function(){var e=this,t=document.createElement(\"div\");t.className=\"labbyMezzageArea\",this.app.appendChild(t);var n=document.createElement(\"div\");n.className=\"labbyMezzageCount\",this.app.appendChild(n);var i=document.createElement(\"textarea\");i.className=\"labbyMezzageContent\",i.onkeypress=function(t){13==t.keyCode&&(t.shiftKey||(t.preventDefault(),e.addMessage()))},this.app.appendChild(i);var r=document.createElement(\"button\");r.className=\"submitBtn\";var a=document.createTextNode(\"Send\");r.appendChild(a),this.app.appendChild(r),r.onclick=function(){e.addMessage(),e.app.getElementsByClassName(\"labbyMezzageContent\")[0].focus()}},MessageBoard.prototype.numberOfMessages=function(){return this.messages.length+\" messages\"},MessageBoard.prototype.renderMessage=function(e){var t=document.createElement(\"section\"),n=document.createElement(\"p\");n.innerHTML=\"Skrivet av: \"+e.getAuthor(),t.appendChild(n);var i=document.createElement(\"p\");i.innerHTML=e.getHTMLText(),t.appendChild(i);var r=document.createElement(\"date\");return r.innerHTML=e.getDateText(),t.appendChild(r),t},MessageBoard.prototype.getMessagesFromServer=function(){var e,t=this,n=function(n){clearTimeout(e);var i;if(t.messages=[],\"undefined\"!=typeof window.DOMParser)i=function(e){return(new window.DOMParser).parseFromString(e,\"text/xml\")};else{if(\"undefined\"==typeof window.ActiveXObject||!new window.ActiveXObject(\"Microsoft.XMLDOM\"))throw new Error(\"No XML parser found\");i=function(e){var t=new window.ActiveXObject(\"Microsoft.XMLDOM\");return t.async=\"false\",t.loadXML(e),t}}var r=new Date,a=r.getMinutes()<10?\"0\"+r.getMinutes():r.getMinutes(),s=r.getSeconds()<10?\"0\"+r.getSeconds():r.getSeconds();t.setStatus(\"Uppdaterad \"+r.getHours()+\":\"+a+\":\"+s);for(var o=i(n),d=o.getElementsByTagName(\"message\"),c=0;c<d.length;c++){{var p=d[c],l=p.querySelector(\"text\").innerHTML,u=p.querySelector(\"time\").innerHTML,m=p.querySelector(\"author\").innerHTML;p.querySelector(\"id\").innerHTML}t.messages.push(new Message(l,new Date(parseInt(u)),m))}t.renderMessages()};t.setStatus(\"Retrieving messages\"),e=setTimeout(function(){t.setStatus(\"Laddar meddelanden...<img src='images/loader_white.gif'>\")},100);var i=void 0!==t.history?\"?history=\"+t.history:\"\";t.connection=new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyserver/getMessage.php\"+i,n,\"GET\"),this.timer=setInterval(function(){e=setTimeout(function(){t.setStatus(\"Laddar meddelanden...<img src='images/loader_white.gif'>\")},100),t.connection=new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyserver/getMessage.php\"+i,n,\"GET\")},t.refreshRate)},MessageBoard.prototype.renderMessages=function(){var e=this.app.getElementsByClassName(\"labbyMezzageArea\")[0],t=this.app.getElementsByClassName(\"labbyMezzageCount\")[0];e.innerHTML=\"\";var n=0,i=this;this.messages.forEach(function(t){e.appendChild(i.renderMessage(t,n)),n++}),t.innerHTML=this.numberOfMessages(),this.scrollToBottom()},MessageBoard.prototype.scrollToBottom=function(){var e=this.app.getElementsByClassName(\"labbyMezzageArea\")[0];e.scrollTop=e.scrollHeight},MessageBoard.prototype.addMessage=function(){var e=this,t=this.app.getElementsByClassName(\"labbyMezzageContent\")[0],n=function(n){console.log(n),t.value=\"\",e.ClearTimers(),e.getMessagesFromServer(),e.scrollToBottom()};\"\"!=t.value&&$.ajax({type:\"POST\",url:\"http://homepage.lnu.se/staff/tstjo/labbyserver/setMessage.php\",data:{username:e.username,text:t.value},success:n})},MessageBoard.prototype.contextMenu=function(){var e=this,t=document.createElement(\"ul\");t.dataset.name=\"Settings\";var n=document.createElement(\"li\"),i=document.createElement(\"a\");return i.href=\"#\",i.innerHTML=\"<img src='images/user.png'> Nickname\",i.onclick=function(t){t.preventDefault(),e.getNickSetting()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/interval.png'> Time interval\",i.onclick=function(t){t.preventDefault(),e.getIntervalSetting()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/messages.png'> Number of messages\",i.onclick=function(t){t.preventDefault(),e.getHistorySetting()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/refresh.png'> Refresh\",i.onclick=function(t){t.preventDefault(),e.ClearTimers(),e.getMessagesFromServer()},n.appendChild(i),t.appendChild(n),[t]},MessageBoard.prototype.getIntervalSetting=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.parentNode.removeChild(t)},t.appendChild(n);var r=document.createElement(\"select\"),a=[[1e4,\"10 sekunder\"],[15e3,\"15 sekunder\"],[3e4,\"30 sekunder\"],[6e4,\"1 minut\"],[3e5,\"5 minuter\"],[6e5,\"10 minuter\"]];r.innerHTML=\"\",a.forEach(function(t){var n=t[0]==e.refreshRate?\" selected\":\"\";r.innerHTML+=\"<option value='\"+t[0]+\"'\"+n+\">\"+t[1]+\"</option>\"}),t.appendChild(r);var s=document.createElement(\"button\");s.innerHTML=\"Ändra\",s.onclick=function(){e.ClearTimers(),e.refreshRate=r.value,e.createCookie(),e.getMessagesFromServer(),e.app.parentNode.removeChild(t)},t.appendChild(s),this.app.parentNode.appendChild(t)},MessageBoard.prototype.getHistorySetting=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.parentNode.removeChild(t)},t.appendChild(n);var r=document.createElement(\"select\"),a=[[5,\"5 meddelanden\"],[10,\"10 meddelanden\"],[20,\"20 meddelanden\"],[50,\"50  meddelanden\"],[void 0,\"Alla  meddelanden\"]];r.innerHTML=\"\",a.forEach(function(t){var n=t[0]==e.history?\" selected\":\"\";r.innerHTML+=\"<option value='\"+t[0]+\"'\"+n+\">\"+t[1]+\"</option>\"}),t.appendChild(r);var s=document.createElement(\"button\");s.innerHTML=\"Ändra\",s.onclick=function(){e.ClearTimers(),e.history=r.value,e.createCookie(),e.getMessagesFromServer(),e.app.parentNode.removeChild(t)},t.appendChild(s),this.app.parentNode.appendChild(t)},MessageBoard.prototype.getNickSetting=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.parentNode.removeChild(t)},t.appendChild(n);var r=document.createElement(\"input\");r.type=\"text\",r.value=e.username,t.appendChild(r);var a=document.createElement(\"button\");a.innerHTML=\"Ändra\",a.onclick=function(){e.username=r.value,e.createCookie(),e.app.parentNode.removeChild(t)},t.appendChild(a),this.app.parentNode.appendChild(t),r.focus(),r.select()},MessageBoard.prototype.createCookie=function(){var e,t=\"setting\",n=this.refreshRate+\",\"+this.username+\",\"+this.history,i=1;if(i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),e=\"; expires=\"+r.toGMTString()}else e=\"\";document.cookie=t+\"=\"+n+e+\"; path=/\"},MessageBoard.prototype.getCookie=function(){var e=\"setting\";if(document.cookie.length>0){var t=document.cookie.indexOf(e+\"=\");if(-1!=t){t=t+e.length+1;var n=document.cookie.indexOf(\";\",t);return-1==n&&(n=document.cookie.length),decodeURI(document.cookie.substring(t,n)).split(\",\")}}return\"\"},ImageWindow.prototype=new Window,ImageWindow.prototype.constructor=ImageWindow,GalleryWindow.prototype=new Window,GalleryWindow.prototype.constructor=GalleryWindow,GalleryWindow.prototype.render=function(){var e=this;this.imageArr.forEach(function(t){var n=document.createElement(\"a\");n.href=\"#\",n.style.width=e.thumbWidth+\"px\",n.style.height=e.thumbHeight+\"px\",n.classList.add(\"imageContainer\"),n.onclick=function(n){n.preventDefault(),e.OpenInNewWindow(t.URL)},n.onmouseover=function(){e.setStatus(\"Bildstorlek: \"+t.width+\"px X \"+t.height+\"px\")},n.onmouseleave=function(){e.setStatus(\"\")};var i=document.createElement(\"img\");i.src=t.thumbURL,n.appendChild(i),e.app.appendChild(n)})},GalleryWindow.prototype.loadImages=function(){var e,t=this,n=function(n){clearTimeout(e),t.setStatus(\"Bilder laddade!\"),t.imageArr=JSON.parse(n);for(var i=0;i<t.imageArr.length;i++)t.imageArr[i].thumbWidth>t.thumbWidth&&(t.thumbWidth=t.imageArr[i].thumbWidth),t.imageArr[i].thumbHeight>t.thumbHeight&&(t.thumbHeight=t.imageArr[i].thumbHeight);t.render()};t.setStatus(\"Laddar bilder...\"),e=setTimeout(function(){t.setStatus(\"Laddar bilder...<img src='images/loader_white.gif'>\")},1500),new AjaxCon(this.Url,n,\"GET\")},MemoryGame.prototype=new Window,MemoryGame.prototype.constructor=MemoryGame,MemoryGame.prototype.resetGame=function(e){var t={getPictureArray:function(e,t){for(var n=e*t,i=n/2,r=[],a=0;n>a;a++)r[a]=0;for(var s=1;i>=s;s++){var o=!1,d=!1;do{if(0==o){var c=Math.floor(Math.random()*(e*t-0)+0);0==r[c]&&(r[c]=s,o=!0)}if(0==d){var p=Math.floor(Math.random()*(e*t-0)+0);0==r[p]&&(r[p]=s,d=!0)}}while(0==o||0==d)}return r}};void 0!==e[0]&&this.setRows(e[0]),void 0!==e[1]&&this.setCols(e[1]),this.app.innerHTML=\"\",this.pictureArray=t.getPictureArray(this.getRows(),this.getCols()),this.structuredArray=this.getStructuredArray(),this.flippedImage=void 0,this.flippedCards=[],this.turnCounter=0,this.renderBoard()},MemoryGame.prototype.renderBoard=function(){var e,t,n,i=this;this.structuredArray.forEach(function(r){e=document.createElement(\"div\"),e.className=\"row\",r.forEach(function(r){t=document.createElement(\"a\"),t.href=\"#\",n=document.createElement(\"img\"),n.src=i.imageLocation+\"0.png\",t.appendChild(n),t.onclick=function(e){e.preventDefault(),i.isActive===!1&&0!==i.flippedCards.indexOf(r.value)&&i.flipCards(this,r)},e.appendChild(t)}),i.app.appendChild(e)})},MemoryGame.prototype.getStructuredArray=function(){var e,t,n=[];for(e=0;e<this.getRows();e++)for(n[e]=[],t=0;t<this.getCols();t++)n[e][t]=[],n[e][t].value=this.pictureArray[this.getCols()*e+t],n[e][t].id=this.getCols()*e+t;return n},MemoryGame.prototype.getSettings=function(e,t){var n=document.createElement(\"div\");n.className=\"overlay\";var i=document.createElement(\"h1\");i.innerHTML=e,n.appendChild(i);var r=document.createElement(\"p\");r.innerHTML=t,n.appendChild(r);var a=document.createElement(\"button\");a.innerHTML=\"Starta spel\";var s=this;a.onclick=function(){s.resetGame([s.getRows(),s.getCols()])},n.appendChild(a),this.app.appendChild(n)},MemoryGame.prototype.flipCards=function(e,t){var n;n=e.firstChild;var i=this;i.isActive=!0,n.className=\"flipped\",setTimeout(function(){n.src=i.imageLocation+t.value+\".png\",void 0===i.flippedImage?(i.flippedImage=[],i.flippedImage.element=n,i.flippedImage.value=t.value,i.isActive=!1):(i.isActive=!0,i.flippedImage.element!=n&&i.flippedImage.value===t.value?(i.turnCounter++,i.flippedCards.push(t.value),i.flippedCards.length>=i.pictureArray.length/2&&i.getSettings(\"Grattis!\",\"Du klarade av spelet på \"+i.turnCounter+\" omgångar, vill du spela igen?\"),i.flippedImage=void 0,i.isActive=!1):i.flippedImage.element===n?i.isActive=!1:(i.turnCounter++,setTimeout(function(){var e=[n,i.flippedImage.element];e.forEach(function(e){e.className=\"\",setTimeout(function(){e.src=i.imageLocation+\"0.png\"},125)}),i.flippedImage=void 0,i.isActive=!1},500)))},125)},MemoryGame.prototype.contextMenu=function(){var e=this,t=document.createElement(\"ul\");t.dataset.name=\"Options\";var n=document.createElement(\"li\"),i=document.createElement(\"a\");i.href=\"#\",i.innerHTML=\"<img src='images/refresh.png'> Reset\",i.onclick=function(t){t.preventDefault(),e.resetGame([e.getRows(),e.getCols()])},n.appendChild(i),t.appendChild(n);var r=document.createElement(\"ul\"),a=[[1,4],[2,4],[3,4],[4,4]];return r.dataset.name=\"Difficulties\",a.forEach(function(t){n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/tiles.png'> \"+t[0]+\"x\"+t[1],i.onclick=function(n){n.preventDefault(),e.resetGame(t)},n.appendChild(i),r.appendChild(n)}),[t,r]},Minesweeper.prototype=new Window,Minesweeper.prototype.constructor=Minesweeper,Minesweeper.prototype.ClearTimers=function(){clearInterval(this.timer)},Minesweeper.prototype.startGame=function(){this.setDefaultValues(),this.drawGame(),this.calculateMines()},Minesweeper.prototype.resetGame=function(){this.resetAllTiles(),this.setDefaultValues(),this.bombsCounter.innerHTML=this.numberOfMines,this.calculateMines(),this.startTimer()},Minesweeper.prototype.setDefaultValues=function(){this.gameOver=!1,this.numberOfMines=Math.floor(this.GameWidth*this.GameWidth*.25),this.mines=[],this.turnedImages=0,this.markedImages=0},Minesweeper.prototype.drawGame=function(){function e(e){if(e.preventDefault(),n.gameOver===!1){var t=Math.floor((e.pageX-this.getBoundingClientRect().left)/n.PictureWidth),i=Math.floor((e.pageY-this.getBoundingClientRect().top)/n.PictureWidth);n.isTurned(i,t)===!1&&(3===e.which?n.isMarked(i,t)===!1?n.setMarker(i,t):n.isMarked(i,t)===!0&&n.removeMarker(i,t):n.hasMine(i,t)?(n.mines.forEach(function(e){n.setImage(e[0],e[1],n.imagePrefix+\"bomb.png\")}),n.setImage(i,t,n.imagePrefix+\"bombred.png\"),clearTimeout(n.timer),n.gameOver=!0):n.showEmptyTiles(i,t),n.bombsCounter.innerHTML=n.numberOfMines-n.markedImages,n.markedImages+n.turnedImages>=n.GameWidth*n.GameWidth&&n.markedImages===n.numberOfMines&&(alert(\"Congratz! You won!\"),clearTimeout(n.timer),n.gameOver=!0))}}var t,n=this;n.app.innerHTML=\"\";var i=document.createElement(\"div\");this.app.style.width=this.GameWidth*this.PictureWidth+\"px\",i.style.width=this.GameWidth*this.PictureWidth+\"px\",i.onclick=e,i.addEventListener(\"contextmenu\",e);var r=document.createElement(\"header\"),a=document.createElement(\"button\");for(a.innerHTML=\"New Game\",a.onclick=function(){n.resetGame()},this.bombsCounter=document.createElement(\"div\"),this.bombsCounter.className=\"bombsLeft\",this.bombsCounter.innerHTML=this.numberOfMines,this.clock=document.createElement(\"div\"),this.clock.className=\"timer\",this.startTimer(),r.appendChild(this.bombsCounter),r.appendChild(a),r.appendChild(this.clock),this.app.appendChild(r),this.app.appendChild(i),this.board=[],t=0;t<this.GameWidth;t++){var s=document.createElement(\"div\");s.className=\"row\";for(var o=[],d=0;d<this.GameWidth;d++){var c=document.createElement(\"img\");c.src=this.imagePrefix+\"standard.png\",s.appendChild(c),o.push({image:c,mine:!1,turned:!1,marked:!1})}this.board.push({rowDiv:s,rowArray:o}),i.appendChild(s)}},Minesweeper.prototype.resetAllTiles=function(){var e,t,n=this;for(e=0;e<this.GameWidth;e++)for(var t=0;t<this.GameWidth;t++){var i=this.board[e].rowArray[t];i.mine=!1,i.turned=!1,i.marked=!1,i.image.src.split(\"/\").indexOf(\"standard.png\")<0&&(i.image.src=n.imagePrefix+\"standard.png\")}},Minesweeper.prototype.calculateMines=function(){for(var e=0;e<this.numberOfMines;e++){var t=Math.floor(Math.random()*this.GameWidth),n=Math.floor(Math.random()*this.GameWidth);this.hasMine(t,n)===!1?(this.setMine(t,n),this.mines.push([t,n])):e--}},Minesweeper.prototype.startTimer=function(){clearTimeout(this.timer);var e=this;this.clock.innerHTML=0;var t=1;this.timer=setInterval(function(){e.clock.innerHTML=t,t++},1e3)},Minesweeper.prototype.contextMenu=function(){var e=this,t=document.createElement(\"ul\");return t.dataset.name=\"Difficulties\",e.difficulties.forEach(function(n){var i=document.createElement(\"li\"),r=document.createElement(\"a\");r.href=\"#\",r.innerHTML=n[0],r.onclick=function(){e.GameWidth=n[1],e.startGame()},i.appendChild(r),t.appendChild(i)}),[t]},Minesweeper.prototype.showEmptyTiles=function(e,t){if(!(e>=this.GameWidth||0>e||t>=this.GameWidth||0>t||this.isTurned(e,t)===!0||this.hasMine(e,t))){if(this.turnImage(e,t),this.turnedImages++,this.hasNeighborMines(e,t)>0)return void this.setImage(e,t,this.imagePrefix+this.hasNeighborMines(e,t)+\".png\");this.setImage(e,t,this.imagePrefix+\"empty.png\"),this.showEmptyTiles(e-1,t),this.showEmptyTiles(e-1,t+1),this.showEmptyTiles(e-1,t-1),this.showEmptyTiles(e+1,t),this.showEmptyTiles(e+1,t+1),this.showEmptyTiles(e+1,t-1),this.showEmptyTiles(e,t-1),this.showEmptyTiles(e,t+1)}},Minesweeper.prototype.isMarked=function(e,t){return this.board[e].rowArray[t].marked},Minesweeper.prototype.setMarker=function(e,t){this.board[e].rowArray[t].marked=!0,this.markedImages<this.numberOfMines&&(this.markedImages++,this.setImage(e,t,this.imagePrefix+\"marked.png\"))},Minesweeper.prototype.removeMarker=function(e,t){this.board[e].rowArray[t].marked=!1,this.markedImages>0&&(this.markedImages--,this.setImage(e,t,this.imagePrefix+\"standard.png\"))},Minesweeper.prototype.hasMine=function(e,t){return this.board[e].rowArray[t].mine},Minesweeper.prototype.isTurned=function(e,t){return this.board[e].rowArray[t].turned},Minesweeper.prototype.turnImage=function(e,t){this.isMarked(e,t)&&this.removeMarker(e,t),this.board[e].rowArray[t].turned=!0},Minesweeper.prototype.setImage=function(e,t,n){this.board[e].rowArray[t].image.src=n},Minesweeper.prototype.setMine=function(e,t){this.board[e].rowArray[t].mine=!0},Minesweeper.prototype.hasNeighborMines=function(e,t){var n,i,r=0;for(n=e-1;e+1>=n;n++)for(i=t-1;t+1>=i;i++)n<this.GameWidth&&n>=0&&i<this.GameWidth&&i>=0&&this.hasMine(n,i)&&r++;return r},NoteWindow.prototype=new Window,NoteWindow.prototype.constructor=NoteWindow,NoteWindow.prototype.render=function(){var e=this;e.app.classList.add(\"Note\");var t=document.createElement(\"textarea\");e.app.parentNode.style.position=\"absolute\",e.app.parentNode.style.right=\"0\",e.app.parentNode.style.left=\"0\",e.app.parentNode.style.top=\"0\",e.app.parentNode.style.bottom=\"0\",e.app.appendChild(t),t.focus()},QuizWindow.prototype=new Window,QuizWindow.prototype.constructor=QuizWindow,QuizWindow.prototype.getScore=function(){var e=this,t=this.app.querySelector(\".workArea\");t.innerHTML=\"\";var n=document.createElement(\"div\");n.className=\"questionList\",t.appendChild(n);for(var i=0,r=0;r<this.questionsArr.length;r++){var a=document.createElement(\"section\");a.className=\"result\",\"Correct answer!\"===this.questionsArr[r].response&&1===this.questionsArr[r].tries?(i++,a.classList.add(\"correct\")):(\"Wrong answer! :(\"===this.questionsArr[r].response||this.questionsArr[r].tries>1)&&a.classList.add(\"incorrect\");var s=document.createElement(\"header\"),o=document.createElement(\"span\");o.innerHTML=this.questionsArr[r].question,s.appendChild(o);var d=document.createElement(\"img\");d.src=\"images/quiz/arrow.svg\",d.alt=\"Arrow\",(a.classList.contains(\"incorrect\")||this.questionsArr[r].tries>1)&&(d.className=\"up\"),s.appendChild(d);var c=document.createElement(\"a\");c.href=\"#\",c.appendChild(s),c.onclick=function(e){e.preventDefault();var t=this.parentNode.querySelector(\".answer\");t.classList.toggle(\"hidden\"),this.parentNode.querySelector(\"img\").classList.toggle(\"up\")},a.appendChild(c);var p=document.createElement(\"section\");p.classList.add(\"answer\"),a.classList.contains(\"incorrect\")||1!=this.questionsArr[r].tries||p.classList.add(\"hidden\"),p.innerHTML=\"Du svarade: \"+this.questionsArr[r].answer,this.questionsArr[r].tries>1&&(p.innerHTML+=\" efter \"+this.questionsArr[r].tries+\" försök\"),a.appendChild(p),n.appendChild(a)}var l=document.createElement(\"div\");l.innerHTML=\"Du fick \"+i+\" av \"+this.questionsArr.length+\" rätt!\",l.className=\"totalScore\",t.appendChild(l);var u=document.createElement(\"button\");u.innerHTML=\"Ny omgång\",u.className=\"btn newGame\",u.onclick=function(){e.init()},t.appendChild(u)},QuizWindow.prototype.disableInput=function(){var e=this.app.querySelector(\".sendAnswer\"),t=this.app.querySelector(\".answerBox\");t.readOnly=!0,e.disabled=!0},QuizWindow.prototype.enableInput=function(){var e=this.app.querySelector(\".sendAnswer\"),t=this.app.querySelector(\".answerBox\");t.readOnly=!1,e.disabled=!1},QuizWindow.prototype.getQuestion=function(e){var t=this,n=function(e){var n=JSON.parse(e);t.nextURL=n.nextURL;var i=t.app.querySelector(\".questionField\");i.classList.toggle(\"opacity-0\"),setTimeout(function(){i.innerHTML=n.question,i.classList.toggle(\"opacity-0\")},250),t.addQuestion(n.question),t.enableInput(),t.setStatus(\"Waiting on input...\")};t.setStatus(\"Waiting on question from server\"),new AjaxCon(e,n,\"GET\")},QuizWindow.prototype.sendAnswer=function(e){var t=this;t.addAnswer(e);var n=function(e){var n=JSON.parse(e);t.addResponse(n.message),void 0!=n.nextURL?t.getQuestion(n.nextURL):\"Wrong answer! :(\"===n.message?(t.enableInput(),t.addFailure(),t.setStatus(\"Waiting on input...\")):(t.gameOver(),t.setStatus(\"No more questions!\"))},i=this.nextURL;this.setStatus(\"Sending answer to server\"),new AjaxCon(i,n,\"POST\",JSON.stringify({answer:e}))},QuizWindow.prototype.init=function(){this.questionsArr=[],this.render(),this.getQuestion(\"http://vhost3.lnu.se:20080/question/1\")},QuizWindow.prototype.gameOver=function(){this.getScore()},QuizWindow.prototype.render=function(){var e=this;this.app.innerHTML=\"\",this.app.classList.add(\"thequiz\");var t=document.createElement(\"div\");t.className=\"workArea\";var n=document.createElement(\"div\");n.className=\"questionField\",t.appendChild(n);var i=document.createElement(\"input\");i.type=\"text\",i.className=\"answerBox\",t.appendChild(i);var r=document.createElement(\"button\");r.className=\"sendAnswer\",r.innerHTML=\"Skicka svar\";var a=function(){\"\"!=i.value&&(e.disableInput(),e.sendAnswer(i.value),i.value=\"\")};r.onclick=a,i.onkeypress=function(e){13==e.keyCode&&a()},t.appendChild(r),this.app.appendChild(t)},QuizWindow.prototype.addAnswer=function(e){this.questionsArr[this.questionsArr.length-1].answer=e},QuizWindow.prototype.addResponse=function(e){this.questionsArr[this.questionsArr.length-1].response=e},QuizWindow.prototype.addQuestion=function(e){this.questionsArr.push({question:e,answer:void 0,response:void 0,tries:1})},QuizWindow.prototype.error=function(){this.app.innerHTML=\"<p>Någonting gick fel!</p><p>Testa att starta om applikationen</p>\"},QuizWindow.prototype.addFailure=function(){this.questionsArr[this.questionsArr.length-1].tries++;var e=document.createElement(\"p\");e.innerHTML=\"Fel svar, försök igen!\",this.app.querySelector(\".questionField\").appendChild(e)},QuoteWindow.prototype=new Window,QuoteWindow.prototype.constructor=QuoteWindow,QuoteWindow.prototype.render=function(){var e=this;e.app.classList.add(\"Quote\");var t,n=function(){var n=function(n){clearTimeout(t),e.setStatus(\"\");var r=JSON.parse(n);if(e.app.innerHTML=\"\",\"undefined\"!=typeof r.Url){var a=document.createElement(\"img\");a.src=r.Url,setTimeout(function(){a.classList.add(\"active\"),setTimeout(function(){a.classList.remove(\"active\")},e.refreshRate-500)},250),e.app.appendChild(a)}var s=document.createElement(\"blockquote\");s.innerHTML=r.Quote.replace(/\\r\\n/g,\"<br/><br/>\"),e.app.appendChild(s),setTimeout(function(){s.classList.add(\"active\"),setTimeout(function(){s.classList.remove(\"active\")},e.refreshRate-500)},250);var o=document.createElement(\"cite\");o.innerHTML=r.Author,s.appendChild(o),i()};e.setStatus(\"Loading quote from server...\"),t=setTimeout(function(){e.setStatus(\"Laddar... <img src='images/loader_white.gif'/>\")},300),e.connection=new AjaxCon(\"http://erikhamrin.se/projects/quotes.php\",n,\"GET\")},i=function(){e.timer=setTimeout(n,e.refreshRate)};n()},QuoteWindow.prototype.ClearTimers=function(){console.log(\"QUOTE: Removing all timers\"),clearTimeout(this.timer),console.log(\"QUOTE: Removing connection\"),this.connection.abort()},RSSWindow.prototype=new Window,RSSWindow.prototype.constructor=RSSWindow,RSSWindow.prototype.reloadFeed=function(){var e=this,t=function(){var t=function(t){var n=new Date,i=n.getMinutes()<10?\"0\"+n.getMinutes():n.getMinutes(),r=n.getSeconds()<10?\"0\"+n.getSeconds():n.getSeconds();e.setStatus(\"Uppdaterad \"+n.getHours()+\":\"+i+\":\"+r),e.feed.innerHTML=t};e.setStatus(\"Laddar RSS-flöde\"),e.connection=new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyServer/rssproxy/?url=\"+encodeURI(e.feedUrl),t,\"GET\")};t(),this.timer=setInterval(t,e.refreshRate)},RSSWindow.prototype.render=function(){var e=this;e.app.className=\"RSSWindow\",e.feed=document.createElement(\"article\"),e.app.appendChild(e.feed)},RSSWindow.prototype.ClearTimers=function(){console.log(\"RSS: Removing all timers\"),clearInterval(this.timer)},RSSWindow.prototype.contextMenu=function(){var e=this,t=document.createElement(\"ul\");t.dataset.name=\"Settings\";var n=document.createElement(\"li\"),i=document.createElement(\"a\");return i.href=\"#\",i.innerHTML=\"<img src='images/interval.png'> Timer interval\",i.onclick=function(t){t.preventDefault(),e.getIntervalSetting()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/setting.png'> Select RSS-feed\",i.onclick=function(t){t.preventDefault(),e.getRSSFeed()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/refresh.png'> Refresh\",i.onclick=function(t){t.preventDefault(),e.ClearTimers(),e.reloadFeed()},n.appendChild(i),t.appendChild(n),[t]},RSSWindow.prototype.getIntervalSetting=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.removeChild(t)},t.appendChild(n);var r=document.createElement(\"select\"),a=[[1e4,\"10 sekunder\"],[15e3,\"15 sekunder\"],[3e4,\"30 sekunder\"],[6e4,\"1 minut\"],[3e5,\"5 minuter\"],[6e5,\"10 minuter\"],[18e5,\"30 minuter\"]];r.innerHTML=\"\",a.forEach(function(t){var n=t[0]==e.refreshRate?\" selected\":\"\";r.innerHTML+=\"<option value='\"+t[0]+\"'\"+n+\">\"+t[1]+\"</option>\"","}),t.appendChild(r);var s=document.createElement(\"button\");s.innerHTML=\"Ändra\",s.onclick=function(){e.ClearTimers(),e.refreshRate=r.value,e.reloadFeed(),e.app.removeChild(t)},t.appendChild(s),this.app.appendChild(t)},RSSWindow.prototype.getRSSFeed=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.removeChild(t)},t.appendChild(n);var r=document.createElement(\"div\");r.classList.add(\"inputcontainer\");var a=document.createElement(\"input\");a.type=\"radio\",a.name=\"rssRadio\",a.value=\"http://www.dn.se/m/rss/senaste-nytt\";var s=document.createTextNode(\"DN - Senaste nytt\");r.appendChild(a),r.appendChild(s),t.appendChild(r),r=document.createElement(\"div\"),r.classList.add(\"inputcontainer\"),a=document.createElement(\"input\"),a.type=\"radio\",a.name=\"rssRadio\",a.value=\"http://www.dn.se/ledare/m/rss\",s=document.createTextNode(\"DN - Ledare\"),r.appendChild(a),r.appendChild(s),t.appendChild(r),r=document.createElement(\"div\"),r.classList.add(\"inputcontainer\"),a=document.createElement(\"input\"),a.type=\"radio\",a.name=\"rssRadio\",a.value=\"http://www.dn.se/ekonomi/m/rss/senaste-nytt\",s=document.createTextNode(\"DN - Ekonomi\"),r.appendChild(a),r.appendChild(s),t.appendChild(r),r=document.createElement(\"div\"),r.classList.add(\"inputcontainer\"),a=document.createElement(\"input\"),a.type=\"radio\",a.name=\"rssRadio\",a.value=\"other\",a.checked=!0,s=document.createTextNode(\"Annat: \"),r.appendChild(a),r.appendChild(s),t.appendChild(r),a.onfocus=function(){o.focus(),o.select()};var o=document.createElement(\"input\");o.type=\"text\",o.value=e.feedUrl,r.appendChild(o);var d=document.createElement(\"button\");d.innerHTML=\"Skicka\",d.onclick=function(){var n=t.querySelector('input[name=\"rssRadio\"]:checked').value;e.feedUrl=\"other\"===n?o.value:n,e.ClearTimers(),e.reloadFeed(),e.app.removeChild(t)},t.appendChild(d),this.app.appendChild(t),o.focus(),o.select()},Window.prototype.focusWindow=function(){for(var e=document.querySelectorAll(\".application\"),t=0;t<e.length;t++)e[t].style.zIndex=\"1\";this.style.zIndex=\"5\"},Window.prototype.createHTML=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"application\"),t.style.left=this.xPos+\"px\",t.style.top=this.yPos+\"px\",t.style.zIndex=\"6\",void 0!==this.startWidth&&(t.style.width=this.startWidth+\"px\"),void 0!==this.startHeight&&(t.style.height=this.startHeight+\"px\"),t.onmousedown=this.focusWindow;var n=document.createElement(\"header\");n.classList.add(\"appHeader\"),n.onmousedown=function(r){t.classList.contains(\"fullscreen\")||r.target==s||r.target==o||r.target==d||(e.dragY=r.pageY-t.offsetTop,e.dragX=r.pageX-t.offsetLeft,n.style.cursor=\"move\",e.dragging=!0,t.classList.add(\"dragging\"),e.DisableSelection(e.desktop.element),n.addEventListener(\"mouseleave\",i),n.addEventListener(\"mousemove\",function(n){e.dragging&&(t.style.top=n.clientY-e.dragY+\"px\",t.style.left=n.clientX-e.dragX+\"px\")}))};var i=function(i){i.clientY-e.dragY+200>window.innerHeight?t.style.top=window.innerHeight-200+\"px\":i.clientY-e.dragY<0&&(t.style.top=\"20px\"),i.clientX-e.dragX+200>window.innerWidth?t.style.left=window.innerWidth-200+\"px\":i.clientX-e.dragX<0&&(t.style.left=\"20px\"),e.dragging=!1,t.classList.remove(\"dragging\"),n.style.removeProperty(\"cursor\"),e.EnableSelection(e.desktop.element)};n.onmouseup=i;var r=document.createElement(\"img\");r.src=this.imageFolder+\"appIcons/\"+this.type+\".png\",r.alt=\"Icon\",r.ondragstart=function(){return!1},r.classList.add(\"appIcon\"),n.appendChild(r);var a=document.createElement(\"h2\");a.innerHTML=this.type,n.appendChild(a);var s=document.createElement(\"img\");s.classList.add(\"appController\"),s.alt=\"Close window\",s.src=this.imageFolder+\"closewindow.png\",s.onclick=function(){\"function\"==typeof e.ClearTimers&&e.ClearTimers(),document.querySelector(\"#desktopApplication\").removeChild(t)},n.appendChild(s);var o=document.createElement(\"img\");o.classList.add(\"appController\"),o.alt=\"Fullscreen\",o.src=this.imageFolder+\"fullsize.png\",o.onclick=function(){t.classList.contains(\"fullscreen\")?(t.style.left=e.xPos+\"px\",t.style.top=e.yPos+\"px\",void 0!==e.startWidth&&(t.style.width=e.startWidth+\"px\"),void 0!==e.startHeight&&(t.style.height=e.startHeight+\"px\")):(e.xPos=t.offsetLeft,e.yPos=t.offsetTop,t.style.removeProperty(\"width\"),t.style.removeProperty(\"height\"),t.style.removeProperty(\"top\"),t.style.removeProperty(\"left\")),t.classList.toggle(\"fullscreen\")},n.appendChild(o);var d=document.createElement(\"img\");d.classList.add(\"appController\"),d.alt=\"Minimize\",d.src=this.imageFolder+\"minimizewindow.png\",d.onclick=function(){e.desktop.hideApp(this,e.imageFolder+\"appIcons/\"+e.type+\"_Large.png\")},n.appendChild(d),t.appendChild(n);var c=document.createElement(\"main\");if(\"undefined\"!=typeof this.contextMenu){var p=document.createElement(\"div\");p.classList.add(\"Menu\"),this.contextMenu().forEach(function(e){var t=e;t.classList.add(\"hide\");var n=document.createElement(\"ul\");n.classList.add(\"contextMenu\");var i=document.createElement(\"a\");i.href=\"#\",i.innerHTML=t.dataset.name;var r=function(){t.classList.add(\"hide\"),document.documentElement.removeEventListener(\"mouseup\",r,!1)};i.onclick=function(e){e.preventDefault(),t.classList.remove(\"hide\"),document.documentElement.addEventListener(\"mouseup\",r,!1)},t.onclick=r,p.appendChild(n),n.appendChild(i),n.appendChild(t)}),c.appendChild(p)}if(this.app=document.createElement(\"div\"),c.appendChild(this.app),t.appendChild(c),e.statusBar=document.createElement(\"footer\"),e.statusBar.classList.add(\"statusBar\"),t.appendChild(e.statusBar),this.resizable){var l,u,m,h,g=function(e){l=e.clientX,u=e.clientY,m=parseInt(document.defaultView.getComputedStyle(t).width,10),h=parseInt(document.defaultView.getComputedStyle(t).height,10),document.documentElement.addEventListener(\"mousemove\",f,!1),document.documentElement.addEventListener(\"mouseup\",v,!1)},f=function(e){m+e.clientX-l<window.innerWidth-300&&(t.style.minWidth=m+e.clientX-l+\"px\"),h+e.clientY-u<window.innerHeight-200&&(t.style.minHeight=h+e.clientY-u+\"px\")},v=function(){document.documentElement.removeEventListener(\"mousemove\",f,!1),document.documentElement.removeEventListener(\"mouseup\",v,!1)},w=document.createElement(\"img\");w.alt=\"Resize\",w.src=this.imageFolder+\"resize.png\",w.className=\"resize noselect\",w.ondragstart=function(){return!1},w.addEventListener(\"mousedown\",g,!1),t.appendChild(w)}document.querySelector(\"#desktopApplication\").appendChild(t)},Window.prototype.setStatus=function(e){this.statusBar.innerHTML=e},Window.prototype.WindowConstruct=function(e,t,n,i,r){this.resizable=t,this.desktop=n,this.xPos=i,this.yPos=r,this.type=e,this.createHTML()},Window.prototype.DisableSelection=function(e){e.onselectstart=function(){return!1},e.unselectable=\"on\",e.style.MozUserSelect=\"none\",e.style.cursor=\"default\"},Window.prototype.EnableSelection=function(e){e.onselectstart=function(){return!0},e.unselectable=\"off\",e.style.MozUserSelect=\"text\",e.style.cursor=\"auto\"},window.onload=function(){new AppLoader(\"Loading your desktop...\"),new Desktop(\"desktopApplication\")};"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":7146},"action":"remove","lines":["\"use strict\";function AjaxCon(e,t,n,i){var r=4,a=this.getXHR();a.onreadystatechange=function(){a.readyState===r&&(a.status>=200&&a.status<300||304===a.status||400===a.status?t(a.responseText):console.log(\"Läsfel, status: \"+a.status))},\"get\"===n||\"GET\"===n?(a.open(\"get\",e,!0),a.send(null)):(a.open(\"POST\",e,!0),a.setRequestHeader(\"Content-Type\",\"application/json; charset=UTF-8\"),a.send(i)),this.abort=function(){a.abort()}}function AppLoader(e){var t=document.createElement(\"div\");t.classList.add(\"AppLoader\");var n=document.createElement(\"h1\");n.innerHTML=e,t.appendChild(n);var i=document.querySelector(\"body\");i.appendChild(t);var r=document.createElement(\"div\");r.classList.add(\"container\"),t.appendChild(r);var a=document.createElement(\"div\");a.classList.add(\"progress\"),r.appendChild(a),setTimeout(function(){a.classList.add(\"loading\"),setTimeout(function(){i.removeChild(t)},1250)},200)}function Message(e,t,n){this.getText=function(){return e},this.setText=function(t){e=t},this.getDate=function(){return t},this.setDate=function(e){t=e},this.getAuthor=function(){return n},this.setAuthor=function(e){n=e}}function MessageBoard(e,t,n){this.WindowConstruct(\"Chat\",!1,e,t,n),this.title=\"Chat\",this.app.classList.add(\"labbymezzage\"),this.messages=[],this.imageLocation=\"images/chat\",this.timer=void 0;var i=this.getCookie();\"object\"==typeof i?(this.refreshRate=i[0],this.username=i[1],this.history=i[2]):(this.refreshRate=1e4,this.username=\"Anonymous\",this.history=20),this.connection=void 0,this.CreateHTMLLayout(),this.getMessagesFromServer()}function Desktop(e){this.windows=[],this.minimizedApps=0,this.element=document.getElementById(e),this.element.classList.add(\"desktop\"),this.navbar=document.createElement(\"nav\");var t=this,n=function(){var e=30*t.windows.length+30;return e/(window.innerWidth-200)>1?e-Math.floor(e/(window.innerWidth-200))*(window.innerWidth-200):30*t.windows.length+30},i=function(){var e=30*t.windows.length+30;return e/(window.innerHeight-300)>1?e-Math.floor(e/(window.innerHeight-300))*(window.innerHeight-300):30*t.windows.length+30};this.element.appendChild(this.navbar);var r=[[MemoryGame,\"images/appIcons/Memory_Large.png\",\"Memory\"],[Minesweeper,\"images/appIcons/Minesweeper_Large.png\",\"Minesweeper\"],[QuizWindow,\"images/appIcons/Quiz_Large.png\",\"Quiz\"],[QuoteWindow,\"images/appIcons/Quote_Large.png\",\"Quotes\"],[MessageBoard,\"images/appIcons/Chat_Large.png\",\"Chat\"],[RSSWindow,\"images/appIcons/RSS_Large.png\",\"RSS\"],[GalleryWindow,\"images/appIcons/Gallery_Large.png\",\"Gallery\"],[NoteWindow,\"images/appIcons/Note_Large.png\",\"Note\"]];r.forEach(function(e){var r=document.createElement(\"a\");r.href=\"#\",r.classList.add(\"appLauncher\"),r.onclick=function(r){r.preventDefault(),t.windows.push(new e[0](t,n(),i()))};var a=document.createElement(\"img\");a.src=e[1],r.appendChild(a);var s=document.createElement(\"span\");s.innerHTML=e[2],r.appendChild(s),t.element.appendChild(r)}),this.hideApp=function(e,n){t.navbar.classList.add(\"showNav\"),e=e.parentNode.parentNode,e.classList.add(\"hidden\"),t.minimizedApps++;var i=document.createElement(\"img\");i.src=n,i.className=\"minimizedWindow\",i.onclick=function(){e.classList.remove(\"hidden\"),t.navbar.removeChild(i),--t.minimizedApps<=0&&t.navbar.classList.remove(\"showNav\")},t.navbar.appendChild(i)}}function ImageWindow(e,t,n,i){var r=document.createElement(\"img\");r.src=e,this.WindowConstruct(\"Gallery\",!1,t,n,i),this.app.appendChild(r)}function GalleryWindow(e,t,n){this.WindowConstruct(\"Gallery\",!1,e,t,n),this.Url=\"http://homepage.lnu.se/staff/tstjo/labbyServer/imgviewer/\",this.thumbWidth=0,this.thumbHeight=0,this.timer=void 0,this.imageArr=void 0,this.app.classList.add(\"Gallery\"),this.OpenInNewWindow=function(i){new ImageWindow(i,e,t+5,n+5)},this.loadImages()}function MemoryGame(e,t,n){var i=2,r=4;this.WindowConstruct(\"Memory\",!1,e,t,n),this.app.classList.add(\"GameOn-Memory\"),this.imageLocation=\"images/memory/\",this.getRows=function(){return i},this.setRows=function(e){i=e},this.getCols=function(){return r},this.setCols=function(e){r=e},this.isActive=!1,this.flippedImage,this.pictureArray,this.structuredArray,this.flippedCards,this.turnCounter,this.resetGame([this.getRows(),this.getCols()])}function Minesweeper(e,t,n){this.difficulties=[[\"Beginner\",9],[\"Intermidiate\",15],[\"Expert\",20]],this.WindowConstruct(\"Minesweeper\",!1,e,t,n),this.app.classList.add(\"GameOn-Minesweeper\"),this.imagePrefix=\"images/minesweeper/\",this.GameWidth=9,this.PictureWidth=20,this.gameOver,this.board=[],this.numberOfMines,this.mines,this.turnedImages,this.markedImages,this.timer,this.clock,this.bombsCounter,this.startGame()}function NoteWindow(e,t,n){this.startHeight=300,this.startWidth=300,this.WindowConstruct(\"Note\",!0,e,t,n),this.render()}function QuizWindow(e,t,n){this.WindowConstruct(\"Quiz\",!1,e,t,n),this.app=this.app,this.nextURL,this.moreQuestions=!0,this.questionsArr,this.init()}function QuoteWindow(e,t,n){this.WindowConstruct(\"Quote\",!1,e,t,n),this.timer,this.connection,this.refreshRate=1e4,this.render()}function RSSWindow(e,t,n){this.startHeight=600,this.startWidth=300,this.WindowConstruct(\"RSS\",!0,e,t,n),this.feedUrl=\"http://www.dn.se/m/rss/senaste-nytt\",this.feed=void 0,this.timer=void 0,this.connection=void 0,this.refreshRate=6e5,this.reloadFeed(),this.render()}function Window(){this.dragY=0,this.dragX=0,this.dragging=!1,this.imageFolder=\"images/\"}AjaxCon.prototype.getXHR=function(){var e=null;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject(\"Microsoft.XMLHTTP\")}catch(t){throw new Error(\"No XHR object available\")}}return e},Message.prototype.getHTMLText=function(){return this.getText()},Message.prototype.getDateText=function(){var e=new Date,t=e-this.getDate(),n=Math.round(t/1e3),i=Math.floor(n/60),r=(Math.floor(i/60),e.getUTCDate()-this.getDate().getUTCDate()),a=e.getUTCMonth()-this.getDate().getUTCMonth(),s=this.getDate().getHours()+\":\"+(this.getDate().getMinutes()<10?\"0\":\"\")+this.getDate().getMinutes()+\":\"+(this.getDate().getSeconds()<10?\"0\":\"\")+this.getDate().getSeconds();return 60>n&&1>a?\"just now\":1==i&&0===a?i+\" minute ago\":60>i&&0===a?i+\" minutes ago\":1>r&&0===a?\"Today \"+s:2>r&&0===a?\"Yesterday \"+s:this.getDate().getUTCDate()+\"/\"+(this.getDate().getMonth()+1)+\"-\"+this.getDate().getFullYear()},MessageBoard.prototype=new Window,MessageBoard.prototype.constructor=MessageBoard,MessageBoard.prototype.ClearTimers=function(){clearInterval(this.timer),\"undefined\"!=typeof this.connection&&this.connection.abort()},MessageBoard.prototype.CreateHTMLLayout=function(){var e=this,t=document.createElement(\"div\");t.className=\"labbyMezzageArea\",this.app.appendChild(t);var n=document.createElement(\"div\");n.className=\"labbyMezzageCount\",this.app.appendChild(n);var i=document.createElement(\"textarea\");i.className=\"labbyMezzageContent\",i.onkeypress=function(t){13==t.keyCode&&(t.shiftKey||(t.preventDefault(),e.addMessage()))},this.app.appendChild(i);var r=document.createElement(\"button\");r.className=\"submitBtn\";var a=document.createTextNode(\"Send\");r.appendChild(a),this.app.appendChild(r),r.onclick=function(){e.addMessage(),e.app.getElementsByClassName(\"labbyMezzageContent\")[0].focus()}},MessageBoard.prototype.numberOfMessages=function(){return this.messages.length+\" messages\"},MessageBoard.prototype.renderMessage=function(e){var t=document.createElement(\"section\"),n=document.createElement(\"p\");n.innerHTML=\"Skrivet av: \"+e.getAuthor(),t.appendChild(n);var i=document.createElement(\"p\");i.innerHTML=e.getHTMLText(),t.appendChild(i);var r=document.createElement(\"date\");return r.innerHTML=e.getDateText(),t.appendChild(r),t},MessageBoard.prototype.getMessagesFromServer=function(){var e,t=this,n=function(n){clearTimeout(e);var i;if(t.messages=[],\"undefined\"!=typeof window.DOMParser)i=function(e){return(new window.DOMParser).parseFromString(e,\"text/xml\")};else{if(\"undefined\"==typeof window.ActiveXObject||!new window.ActiveXObject(\"Microsoft.XMLDOM\"))throw new Error(\"No XML parser found\");i=function(e){var t=new window.ActiveXObject(\"Microsoft.XMLDOM\");return t.async=\"false\",t.loadXML(e),t}}var r=new Date,a=r.getMinutes()<10?\"0\"+r.getMinutes():r.getMinutes(),s=r.getSeconds()<10?\"0\"+r.getSeconds():r.getSeconds();t.setStatus(\"Uppdaterad \"+r.getHours()+\":\"+a+\":\"+s);for(var o=i(n),d=o.getElementsByTagName(\"message\"),c=0;c<d.length;c++){{var p=d[c],l=p.querySelector(\"text\").innerHTML,u=p.querySelector(\"time\").innerHTML,m=p.querySelector(\"author\").innerHTML;p.querySelector(\"id\").innerHTML}t.messages.push(new Message(l,new Date(parseInt(u)),m))}t.renderMessages()};t.setStatus(\"Retrieving messages\"),e=setTimeout(function(){t.setStatus(\"Laddar meddelanden...<img src='images/loader_white.gif'>\")},100);var i=void 0!==t.history?\"?history=\"+t.history:\"\";t.connection=new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyserver/getMessage.php\"+i,n,\"GET\"),this.timer=setInterval(function(){e=setTimeout(function(){t.setStatus(\"Laddar meddelanden...<img src='images/loader_white.gif'>\")},100),t.connection=new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyserver/getMessage.php\"+i,n,\"GET\")},t.refreshRate)},MessageBoard.prototype.renderMessages=function(){var e=this.app.getElementsByClassName(\"labbyMezzageArea\")[0],t=this.app.getElementsByClassName(\"labbyMezzageCount\")[0];e.innerHTML=\"\";var n=0,i=this;this.messages.forEach(function(t){e.appendChild(i.renderMessage(t,n)),n++}),t.innerHTML=this.numberOfMessages(),this.scrollToBottom()},MessageBoard.prototype.scrollToBottom=function(){var e=this.app.getElementsByClassName(\"labbyMezzageArea\")[0];e.scrollTop=e.scrollHeight},MessageBoard.prototype.addMessage=function(){var e=this,t=this.app.getElementsByClassName(\"labbyMezzageContent\")[0],n=function(n){console.log(n),t.value=\"\",e.ClearTimers(),e.getMessagesFromServer(),e.scrollToBottom()};\"\"!=t.value&&$.ajax({type:\"POST\",url:\"http://homepage.lnu.se/staff/tstjo/labbyserver/setMessage.php\",data:{username:e.username,text:t.value},success:n})},MessageBoard.prototype.contextMenu=function(){var e=this,t=document.createElement(\"ul\");t.dataset.name=\"Settings\";var n=document.createElement(\"li\"),i=document.createElement(\"a\");return i.href=\"#\",i.innerHTML=\"<img src='images/user.png'> Nickname\",i.onclick=function(t){t.preventDefault(),e.getNickSetting()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/interval.png'> Time interval\",i.onclick=function(t){t.preventDefault(),e.getIntervalSetting()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/messages.png'> Number of messages\",i.onclick=function(t){t.preventDefault(),e.getHistorySetting()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/refresh.png'> Refresh\",i.onclick=function(t){t.preventDefault(),e.ClearTimers(),e.getMessagesFromServer()},n.appendChild(i),t.appendChild(n),[t]},MessageBoard.prototype.getIntervalSetting=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.parentNode.removeChild(t)},t.appendChild(n);var r=document.createElement(\"select\"),a=[[1e4,\"10 sekunder\"],[15e3,\"15 sekunder\"],[3e4,\"30 sekunder\"],[6e4,\"1 minut\"],[3e5,\"5 minuter\"],[6e5,\"10 minuter\"]];r.innerHTML=\"\",a.forEach(function(t){var n=t[0]==e.refreshRate?\" selected\":\"\";r.innerHTML+=\"<option value='\"+t[0]+\"'\"+n+\">\"+t[1]+\"</option>\"}),t.appendChild(r);var s=document.createElement(\"button\");s.innerHTML=\"Ändra\",s.onclick=function(){e.ClearTimers(),e.refreshRate=r.value,e.createCookie(),e.getMessagesFromServer(),e.app.parentNode.removeChild(t)},t.appendChild(s),this.app.parentNode.appendChild(t)},MessageBoard.prototype.getHistorySetting=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.parentNode.removeChild(t)},t.appendChild(n);var r=document.createElement(\"select\"),a=[[5,\"5 meddelanden\"],[10,\"10 meddelanden\"],[20,\"20 meddelanden\"],[50,\"50  meddelanden\"],[void 0,\"Alla  meddelanden\"]];r.innerHTML=\"\",a.forEach(function(t){var n=t[0]==e.history?\" selected\":\"\";r.innerHTML+=\"<option value='\"+t[0]+\"'\"+n+\">\"+t[1]+\"</option>\"}),t.appendChild(r);var s=document.createElement(\"button\");s.innerHTML=\"Ändra\",s.onclick=function(){e.ClearTimers(),e.history=r.value,e.createCookie(),e.getMessagesFromServer(),e.app.parentNode.removeChild(t)},t.appendChild(s),this.app.parentNode.appendChild(t)},MessageBoard.prototype.getNickSetting=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.parentNode.removeChild(t)},t.appendChild(n);var r=document.createElement(\"input\");r.type=\"text\",r.value=e.username,t.appendChild(r);var a=document.createElement(\"button\");a.innerHTML=\"Ändra\",a.onclick=function(){e.username=r.value,e.createCookie(),e.app.parentNode.removeChild(t)},t.appendChild(a),this.app.parentNode.appendChild(t),r.focus(),r.select()},MessageBoard.prototype.createCookie=function(){var e,t=\"setting\",n=this.refreshRate+\",\"+this.username+\",\"+this.history,i=1;if(i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),e=\"; expires=\"+r.toGMTString()}else e=\"\";document.cookie=t+\"=\"+n+e+\"; path=/\"},MessageBoard.prototype.getCookie=function(){var e=\"setting\";if(document.cookie.length>0){var t=document.cookie.indexOf(e+\"=\");if(-1!=t){t=t+e.length+1;var n=document.cookie.indexOf(\";\",t);return-1==n&&(n=document.cookie.length),decodeURI(document.cookie.substring(t,n)).split(\",\")}}return\"\"},ImageWindow.prototype=new Window,ImageWindow.prototype.constructor=ImageWindow,GalleryWindow.prototype=new Window,GalleryWindow.prototype.constructor=GalleryWindow,GalleryWindow.prototype.render=function(){var e=this;this.imageArr.forEach(function(t){var n=document.createElement(\"a\");n.href=\"#\",n.style.width=e.thumbWidth+\"px\",n.style.height=e.thumbHeight+\"px\",n.classList.add(\"imageContainer\"),n.onclick=function(n){n.preventDefault(),e.OpenInNewWindow(t.URL)},n.onmouseover=function(){e.setStatus(\"Bildstorlek: \"+t.width+\"px X \"+t.height+\"px\")},n.onmouseleave=function(){e.setStatus(\"\")};var i=document.createElement(\"img\");i.src=t.thumbURL,n.appendChild(i),e.app.appendChild(n)})},GalleryWindow.prototype.loadImages=function(){var e,t=this,n=function(n){clearTimeout(e),t.setStatus(\"Bilder laddade!\"),t.imageArr=JSON.parse(n);for(var i=0;i<t.imageArr.length;i++)t.imageArr[i].thumbWidth>t.thumbWidth&&(t.thumbWidth=t.imageArr[i].thumbWidth),t.imageArr[i].thumbHeight>t.thumbHeight&&(t.thumbHeight=t.imageArr[i].thumbHeight);t.render()};t.setStatus(\"Laddar bilder...\"),e=setTimeout(function(){t.setStatus(\"Laddar bilder...<img src='images/loader_white.gif'>\")},1500),new AjaxCon(this.Url,n,\"GET\")},MemoryGame.prototype=new Window,MemoryGame.prototype.constructor=MemoryGame,MemoryGame.prototype.resetGame=function(e){var t={getPictureArray:function(e,t){for(var n=e*t,i=n/2,r=[],a=0;n>a;a++)r[a]=0;for(var s=1;i>=s;s++){var o=!1,d=!1;do{if(0==o){var c=Math.floor(Math.random()*(e*t-0)+0);0==r[c]&&(r[c]=s,o=!0)}if(0==d){var p=Math.floor(Math.random()*(e*t-0)+0);0==r[p]&&(r[p]=s,d=!0)}}while(0==o||0==d)}return r}};void 0!==e[0]&&this.setRows(e[0]),void 0!==e[1]&&this.setCols(e[1]),this.app.innerHTML=\"\",this.pictureArray=t.getPictureArray(this.getRows(),this.getCols()),this.structuredArray=this.getStructuredArray(),this.flippedImage=void 0,this.flippedCards=[],this.turnCounter=0,this.renderBoard()},MemoryGame.prototype.renderBoard=function(){var e,t,n,i=this;this.structuredArray.forEach(function(r){e=document.createElement(\"div\"),e.className=\"row\",r.forEach(function(r){t=document.createElement(\"a\"),t.href=\"#\",n=document.createElement(\"img\"),n.src=i.imageLocation+\"0.png\",t.appendChild(n),t.onclick=function(e){e.preventDefault(),i.isActive===!1&&0!==i.flippedCards.indexOf(r.value)&&i.flipCards(this,r)},e.appendChild(t)}),i.app.appendChild(e)})},MemoryGame.prototype.getStructuredArray=function(){var e,t,n=[];for(e=0;e<this.getRows();e++)for(n[e]=[],t=0;t<this.getCols();t++)n[e][t]=[],n[e][t].value=this.pictureArray[this.getCols()*e+t],n[e][t].id=this.getCols()*e+t;return n},MemoryGame.prototype.getSettings=function(e,t){var n=document.createElement(\"div\");n.className=\"overlay\";var i=document.createElement(\"h1\");i.innerHTML=e,n.appendChild(i);var r=document.createElement(\"p\");r.innerHTML=t,n.appendChild(r);var a=document.createElement(\"button\");a.innerHTML=\"Starta spel\";var s=this;a.onclick=function(){s.resetGame([s.getRows(),s.getCols()])},n.appendChild(a),this.app.appendChild(n)},MemoryGame.prototype.flipCards=function(e,t){var n;n=e.firstChild;var i=this;i.isActive=!0,n.className=\"flipped\",setTimeout(function(){n.src=i.imageLocation+t.value+\".png\",void 0===i.flippedImage?(i.flippedImage=[],i.flippedImage.element=n,i.flippedImage.value=t.value,i.isActive=!1):(i.isActive=!0,i.flippedImage.element!=n&&i.flippedImage.value===t.value?(i.turnCounter++,i.flippedCards.push(t.value),i.flippedCards.length>=i.pictureArray.length/2&&i.getSettings(\"Grattis!\",\"Du klarade av spelet på \"+i.turnCounter+\" omgångar, vill du spela igen?\"),i.flippedImage=void 0,i.isActive=!1):i.flippedImage.element===n?i.isActive=!1:(i.turnCounter++,setTimeout(function(){var e=[n,i.flippedImage.element];e.forEach(function(e){e.className=\"\",setTimeout(function(){e.src=i.imageLocation+\"0.png\"},125)}),i.flippedImage=void 0,i.isActive=!1},500)))},125)},MemoryGame.prototype.contextMenu=function(){var e=this,t=document.createElement(\"ul\");t.dataset.name=\"Options\";var n=document.createElement(\"li\"),i=document.createElement(\"a\");i.href=\"#\",i.innerHTML=\"<img src='images/refresh.png'> Reset\",i.onclick=function(t){t.preventDefault(),e.resetGame([e.getRows(),e.getCols()])},n.appendChild(i),t.appendChild(n);var r=document.createElement(\"ul\"),a=[[1,4],[2,4],[3,4],[4,4]];return r.dataset.name=\"Difficulties\",a.forEach(function(t){n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/tiles.png'> \"+t[0]+\"x\"+t[1],i.onclick=function(n){n.preventDefault(),e.resetGame(t)},n.appendChild(i),r.appendChild(n)}),[t,r]},Minesweeper.prototype=new Window,Minesweeper.prototype.constructor=Minesweeper,Minesweeper.prototype.ClearTimers=function(){clearInterval(this.timer)},Minesweeper.prototype.startGame=function(){this.setDefaultValues(),this.drawGame(),this.calculateMines()},Minesweeper.prototype.resetGame=function(){this.resetAllTiles(),this.setDefaultValues(),this.bombsCounter.innerHTML=this.numberOfMines,this.calculateMines(),this.startTimer()},Minesweeper.prototype.setDefaultValues=function(){this.gameOver=!1,this.numberOfMines=Math.floor(this.GameWidth*this.GameWidth*.25),this.mines=[],this.turnedImages=0,this.markedImages=0},Minesweeper.prototype.drawGame=function(){function e(e){if(e.preventDefault(),n.gameOver===!1){var t=Math.floor((e.pageX-this.getBoundingClientRect().left)/n.PictureWidth),i=Math.floor((e.pageY-this.getBoundingClientRect().top)/n.PictureWidth);n.isTurned(i,t)===!1&&(3===e.which?n.isMarked(i,t)===!1?n.setMarker(i,t):n.isMarked(i,t)===!0&&n.removeMarker(i,t):n.hasMine(i,t)?(n.mines.forEach(function(e){n.setImage(e[0],e[1],n.imagePrefix+\"bomb.png\")}),n.setImage(i,t,n.imagePrefix+\"bombred.png\"),clearTimeout(n.timer),n.gameOver=!0):n.showEmptyTiles(i,t),n.bombsCounter.innerHTML=n.numberOfMines-n.markedImages,n.markedImages+n.turnedImages>=n.GameWidth*n.GameWidth&&n.markedImages===n.numberOfMines&&(alert(\"Congratz! You won!\"),clearTimeout(n.timer),n.gameOver=!0))}}var t,n=this;n.app.innerHTML=\"\";var i=document.createElement(\"div\");this.app.style.width=this.GameWidth*this.PictureWidth+\"px\",i.style.width=this.GameWidth*this.PictureWidth+\"px\",i.onclick=e,i.addEventListener(\"contextmenu\",e);var r=document.createElement(\"header\"),a=document.createElement(\"button\");for(a.innerHTML=\"New Game\",a.onclick=function(){n.resetGame()},this.bombsCounter=document.createElement(\"div\"),this.bombsCounter.className=\"bombsLeft\",this.bombsCounter.innerHTML=this.numberOfMines,this.clock=document.createElement(\"div\"),this.clock.className=\"timer\",this.startTimer(),r.appendChild(this.bombsCounter),r.appendChild(a),r.appendChild(this.clock),this.app.appendChild(r),this.app.appendChild(i),this.board=[],t=0;t<this.GameWidth;t++){var s=document.createElement(\"div\");s.className=\"row\";for(var o=[],d=0;d<this.GameWidth;d++){var c=document.createElement(\"img\");c.src=this.imagePrefix+\"standard.png\",s.appendChild(c),o.push({image:c,mine:!1,turned:!1,marked:!1})}this.board.push({rowDiv:s,rowArray:o}),i.appendChild(s)}},Minesweeper.prototype.resetAllTiles=function(){var e,t,n=this;for(e=0;e<this.GameWidth;e++)for(var t=0;t<this.GameWidth;t++){var i=this.board[e].rowArray[t];i.mine=!1,i.turned=!1,i.marked=!1,i.image.src.split(\"/\").indexOf(\"standard.png\")<0&&(i.image.src=n.imagePrefix+\"standard.png\")}},Minesweeper.prototype.calculateMines=function(){for(var e=0;e<this.numberOfMines;e++){var t=Math.floor(Math.random()*this.GameWidth),n=Math.floor(Math.random()*this.GameWidth);this.hasMine(t,n)===!1?(this.setMine(t,n),this.mines.push([t,n])):e--}},Minesweeper.prototype.startTimer=function(){clearTimeout(this.timer);var e=this;this.clock.innerHTML=0;var t=1;this.timer=setInterval(function(){e.clock.innerHTML=t,t++},1e3)},Minesweeper.prototype.contextMenu=function(){var e=this,t=document.createElement(\"ul\");return t.dataset.name=\"Difficulties\",e.difficulties.forEach(function(n){var i=document.createElement(\"li\"),r=document.createElement(\"a\");r.href=\"#\",r.innerHTML=n[0],r.onclick=function(){e.GameWidth=n[1],e.startGame()},i.appendChild(r),t.appendChild(i)}),[t]},Minesweeper.prototype.showEmptyTiles=function(e,t){if(!(e>=this.GameWidth||0>e||t>=this.GameWidth||0>t||this.isTurned(e,t)===!0||this.hasMine(e,t))){if(this.turnImage(e,t),this.turnedImages++,this.hasNeighborMines(e,t)>0)return void this.setImage(e,t,this.imagePrefix+this.hasNeighborMines(e,t)+\".png\");this.setImage(e,t,this.imagePrefix+\"empty.png\"),this.showEmptyTiles(e-1,t),this.showEmptyTiles(e-1,t+1),this.showEmptyTiles(e-1,t-1),this.showEmptyTiles(e+1,t),this.showEmptyTiles(e+1,t+1),this.showEmptyTiles(e+1,t-1),this.showEmptyTiles(e,t-1),this.showEmptyTiles(e,t+1)}},Minesweeper.prototype.isMarked=function(e,t){return this.board[e].rowArray[t].marked},Minesweeper.prototype.setMarker=function(e,t){this.board[e].rowArray[t].marked=!0,this.markedImages<this.numberOfMines&&(this.markedImages++,this.setImage(e,t,this.imagePrefix+\"marked.png\"))},Minesweeper.prototype.removeMarker=function(e,t){this.board[e].rowArray[t].marked=!1,this.markedImages>0&&(this.markedImages--,this.setImage(e,t,this.imagePrefix+\"standard.png\"))},Minesweeper.prototype.hasMine=function(e,t){return this.board[e].rowArray[t].mine},Minesweeper.prototype.isTurned=function(e,t){return this.board[e].rowArray[t].turned},Minesweeper.prototype.turnImage=function(e,t){this.isMarked(e,t)&&this.removeMarker(e,t),this.board[e].rowArray[t].turned=!0},Minesweeper.prototype.setImage=function(e,t,n){this.board[e].rowArray[t].image.src=n},Minesweeper.prototype.setMine=function(e,t){this.board[e].rowArray[t].mine=!0},Minesweeper.prototype.hasNeighborMines=function(e,t){var n,i,r=0;for(n=e-1;e+1>=n;n++)for(i=t-1;t+1>=i;i++)n<this.GameWidth&&n>=0&&i<this.GameWidth&&i>=0&&this.hasMine(n,i)&&r++;return r},NoteWindow.prototype=new Window,NoteWindow.prototype.constructor=NoteWindow,NoteWindow.prototype.render=function(){var e=this;e.app.classList.add(\"Note\");var t=document.createElement(\"textarea\");e.app.parentNode.style.position=\"absolute\",e.app.parentNode.style.right=\"0\",e.app.parentNode.style.left=\"0\",e.app.parentNode.style.top=\"0\",e.app.parentNode.style.bottom=\"0\",e.app.appendChild(t),t.focus()},QuizWindow.prototype=new Window,QuizWindow.prototype.constructor=QuizWindow,QuizWindow.prototype.getScore=function(){var e=this,t=this.app.querySelector(\".workArea\");t.innerHTML=\"\";var n=document.createElement(\"div\");n.className=\"questionList\",t.appendChild(n);for(var i=0,r=0;r<this.questionsArr.length;r++){var a=document.createElement(\"section\");a.className=\"result\",\"Correct answer!\"===this.questionsArr[r].response&&1===this.questionsArr[r].tries?(i++,a.classList.add(\"correct\")):(\"Wrong answer! :(\"===this.questionsArr[r].response||this.questionsArr[r].tries>1)&&a.classList.add(\"incorrect\");var s=document.createElement(\"header\"),o=document.createElement(\"span\");o.innerHTML=this.questionsArr[r].question,s.appendChild(o);var d=document.createElement(\"img\");d.src=\"images/quiz/arrow.svg\",d.alt=\"Arrow\",(a.classList.contains(\"incorrect\")||this.questionsArr[r].tries>1)&&(d.className=\"up\"),s.appendChild(d);var c=document.createElement(\"a\");c.href=\"#\",c.appendChild(s),c.onclick=function(e){e.preventDefault();var t=this.parentNode.querySelector(\".answer\");t.classList.toggle(\"hidden\"),this.parentNode.querySelector(\"img\").classList.toggle(\"up\")},a.appendChild(c);var p=document.createElement(\"section\");p.classList.add(\"answer\"),a.classList.contains(\"incorrect\")||1!=this.questionsArr[r].tries||p.classList.add(\"hidden\"),p.innerHTML=\"Du svarade: \"+this.questionsArr[r].answer,this.questionsArr[r].tries>1&&(p.innerHTML+=\" efter \"+this.questionsArr[r].tries+\" försök\"),a.appendChild(p),n.appendChild(a)}var l=document.createElement(\"div\");l.innerHTML=\"Du fick \"+i+\" av \"+this.questionsArr.length+\" rätt!\",l.className=\"totalScore\",t.appendChild(l);var u=document.createElement(\"button\");u.innerHTML=\"Ny omgång\",u.className=\"btn newGame\",u.onclick=function(){e.init()},t.appendChild(u)},QuizWindow.prototype.disableInput=function(){var e=this.app.querySelector(\".sendAnswer\"),t=this.app.querySelector(\".answerBox\");t.readOnly=!0,e.disabled=!0},QuizWindow.prototype.enableInput=function(){var e=this.app.querySelector(\".sendAnswer\"),t=this.app.querySelector(\".answerBox\");t.readOnly=!1,e.disabled=!1},QuizWindow.prototype.getQuestion=function(e){var t=this,n=function(e){var n=JSON.parse(e);t.nextURL=n.nextURL;var i=t.app.querySelector(\".questionField\");i.classList.toggle(\"opacity-0\"),setTimeout(function(){i.innerHTML=n.question,i.classList.toggle(\"opacity-0\")},250),t.addQuestion(n.question),t.enableInput(),t.setStatus(\"Waiting on input...\")};t.setStatus(\"Waiting on question from server\"),new AjaxCon(e,n,\"GET\")},QuizWindow.prototype.sendAnswer=function(e){var t=this;t.addAnswer(e);var n=function(e){var n=JSON.parse(e);t.addResponse(n.message),void 0!=n.nextURL?t.getQuestion(n.nextURL):\"Wrong answer! :(\"===n.message?(t.enableInput(),t.addFailure(),t.setStatus(\"Waiting on input...\")):(t.gameOver(),t.setStatus(\"No more questions!\"))},i=this.nextURL;this.setStatus(\"Sending answer to server\"),new AjaxCon(i,n,\"POST\",JSON.stringify({answer:e}))},QuizWindow.prototype.init=function(){this.questionsArr=[],this.render(),this.getQuestion(\"http://vhost3.lnu.se:20080/question/1\")},QuizWindow.prototype.gameOver=function(){this.getScore()},QuizWindow.prototype.render=function(){var e=this;this.app.innerHTML=\"\",this.app.classList.add(\"thequiz\");var t=document.createElement(\"div\");t.className=\"workArea\";var n=document.createElement(\"div\");n.className=\"questionField\",t.appendChild(n);var i=document.createElement(\"input\");i.type=\"text\",i.className=\"answerBox\",t.appendChild(i);var r=document.createElement(\"button\");r.className=\"sendAnswer\",r.innerHTML=\"Skicka svar\";var a=function(){\"\"!=i.value&&(e.disableInput(),e.sendAnswer(i.value),i.value=\"\")};r.onclick=a,i.onkeypress=function(e){13==e.keyCode&&a()},t.appendChild(r),this.app.appendChild(t)},QuizWindow.prototype.addAnswer=function(e){this.questionsArr[this.questionsArr.length-1].answer=e},QuizWindow.prototype.addResponse=function(e){this.questionsArr[this.questionsArr.length-1].response=e},QuizWindow.prototype.addQuestion=function(e){this.questionsArr.push({question:e,answer:void 0,response:void 0,tries:1})},QuizWindow.prototype.error=function(){this.app.innerHTML=\"<p>Någonting gick fel!</p><p>Testa att starta om applikationen</p>\"},QuizWindow.prototype.addFailure=function(){this.questionsArr[this.questionsArr.length-1].tries++;var e=document.createElement(\"p\");e.innerHTML=\"Fel svar, försök igen!\",this.app.querySelector(\".questionField\").appendChild(e)},QuoteWindow.prototype=new Window,QuoteWindow.prototype.constructor=QuoteWindow,QuoteWindow.prototype.render=function(){var e=this;e.app.classList.add(\"Quote\");var t,n=function(){var n=function(n){clearTimeout(t),e.setStatus(\"\");var r=JSON.parse(n);if(e.app.innerHTML=\"\",\"undefined\"!=typeof r.Url){var a=document.createElement(\"img\");a.src=r.Url,setTimeout(function(){a.classList.add(\"active\"),setTimeout(function(){a.classList.remove(\"active\")},e.refreshRate-500)},250),e.app.appendChild(a)}var s=document.createElement(\"blockquote\");s.innerHTML=r.Quote.replace(/\\r\\n/g,\"<br/><br/>\"),e.app.appendChild(s),setTimeout(function(){s.classList.add(\"active\"),setTimeout(function(){s.classList.remove(\"active\")},e.refreshRate-500)},250);var o=document.createElement(\"cite\");o.innerHTML=r.Author,s.appendChild(o),i()};e.setStatus(\"Loading quote from server...\"),t=setTimeout(function(){e.setStatus(\"Laddar... <img src='images/loader_white.gif'/>\")},300),e.connection=new AjaxCon(\"http://erikhamrin.se/projects/quotes.php\",n,\"GET\")},i=function(){e.timer=setTimeout(n,e.refreshRate)};n()},QuoteWindow.prototype.ClearTimers=function(){console.log(\"QUOTE: Removing all timers\"),clearTimeout(this.timer),console.log(\"QUOTE: Removing connection\"),this.connection.abort()},RSSWindow.prototype=new Window,RSSWindow.prototype.constructor=RSSWindow,RSSWindow.prototype.reloadFeed=function(){var e=this,t=function(){var t=function(t){var n=new Date,i=n.getMinutes()<10?\"0\"+n.getMinutes():n.getMinutes(),r=n.getSeconds()<10?\"0\"+n.getSeconds():n.getSeconds();e.setStatus(\"Uppdaterad \"+n.getHours()+\":\"+i+\":\"+r),e.feed.innerHTML=t};e.setStatus(\"Laddar RSS-flöde\"),e.connection=new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyServer/rssproxy/?url=\"+encodeURI(e.feedUrl),t,\"GET\")};t(),this.timer=setInterval(t,e.refreshRate)},RSSWindow.prototype.render=function(){var e=this;e.app.className=\"RSSWindow\",e.feed=document.createElement(\"article\"),e.app.appendChild(e.feed)},RSSWindow.prototype.ClearTimers=function(){console.log(\"RSS: Removing all timers\"),clearInterval(this.timer)},RSSWindow.prototype.contextMenu=function(){var e=this,t=document.createElement(\"ul\");t.dataset.name=\"Settings\";var n=document.createElement(\"li\"),i=document.createElement(\"a\");return i.href=\"#\",i.innerHTML=\"<img src='images/interval.png'> Timer interval\",i.onclick=function(t){t.preventDefault(),e.getIntervalSetting()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/setting.png'> Select RSS-feed\",i.onclick=function(t){t.preventDefault(),e.getRSSFeed()},n.appendChild(i),t.appendChild(n),n=document.createElement(\"li\"),i=document.createElement(\"a\"),i.href=\"#\",i.innerHTML=\"<img src='images/refresh.png'> Refresh\",i.onclick=function(t){t.preventDefault(),e.ClearTimers(),e.reloadFeed()},n.appendChild(i),t.appendChild(n),[t]},RSSWindow.prototype.getIntervalSetting=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.removeChild(t)},t.appendChild(n);var r=document.createElement(\"select\"),a=[[1e4,\"10 sekunder\"],[15e3,\"15 sekunder\"],[3e4,\"30 sekunder\"],[6e4,\"1 minut\"],[3e5,\"5 minuter\"],[6e5,\"10 minuter\"],[18e5,\"30 minuter\"]];r.innerHTML=\"\",a.forEach(function(t){var n=t[0]==e.refreshRate?\" selected\":\"\";r.innerHTML+=\"<option value='\"+t[0]+\"'\"+n+\">\"+t[1]+\"</option>\"","}),t.appendChild(r);var s=document.createElement(\"button\");s.innerHTML=\"Ändra\",s.onclick=function(){e.ClearTimers(),e.refreshRate=r.value,e.reloadFeed(),e.app.removeChild(t)},t.appendChild(s),this.app.appendChild(t)},RSSWindow.prototype.getRSSFeed=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"popup\");var n=document.createElement(\"a\");n.href=\"#\";var i=document.createElement(\"img\");i.src=\"images/closewindow.png\",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.removeChild(t)},t.appendChild(n);var r=document.createElement(\"div\");r.classList.add(\"inputcontainer\");var a=document.createElement(\"input\");a.type=\"radio\",a.name=\"rssRadio\",a.value=\"http://www.dn.se/m/rss/senaste-nytt\";var s=document.createTextNode(\"DN - Senaste nytt\");r.appendChild(a),r.appendChild(s),t.appendChild(r),r=document.createElement(\"div\"),r.classList.add(\"inputcontainer\"),a=document.createElement(\"input\"),a.type=\"radio\",a.name=\"rssRadio\",a.value=\"http://www.dn.se/ledare/m/rss\",s=document.createTextNode(\"DN - Ledare\"),r.appendChild(a),r.appendChild(s),t.appendChild(r),r=document.createElement(\"div\"),r.classList.add(\"inputcontainer\"),a=document.createElement(\"input\"),a.type=\"radio\",a.name=\"rssRadio\",a.value=\"http://www.dn.se/ekonomi/m/rss/senaste-nytt\",s=document.createTextNode(\"DN - Ekonomi\"),r.appendChild(a),r.appendChild(s),t.appendChild(r),r=document.createElement(\"div\"),r.classList.add(\"inputcontainer\"),a=document.createElement(\"input\"),a.type=\"radio\",a.name=\"rssRadio\",a.value=\"other\",a.checked=!0,s=document.createTextNode(\"Annat: \"),r.appendChild(a),r.appendChild(s),t.appendChild(r),a.onfocus=function(){o.focus(),o.select()};var o=document.createElement(\"input\");o.type=\"text\",o.value=e.feedUrl,r.appendChild(o);var d=document.createElement(\"button\");d.innerHTML=\"Skicka\",d.onclick=function(){var n=t.querySelector('input[name=\"rssRadio\"]:checked').value;e.feedUrl=\"other\"===n?o.value:n,e.ClearTimers(),e.reloadFeed(),e.app.removeChild(t)},t.appendChild(d),this.app.appendChild(t),o.focus(),o.select()},Window.prototype.focusWindow=function(){for(var e=document.querySelectorAll(\".application\"),t=0;t<e.length;t++)e[t].style.zIndex=\"1\";this.style.zIndex=\"5\"},Window.prototype.createHTML=function(){var e=this,t=document.createElement(\"div\");t.classList.add(\"application\"),t.style.left=this.xPos+\"px\",t.style.top=this.yPos+\"px\",t.style.zIndex=\"6\",void 0!==this.startWidth&&(t.style.width=this.startWidth+\"px\"),void 0!==this.startHeight&&(t.style.height=this.startHeight+\"px\"),t.onmousedown=this.focusWindow;var n=document.createElement(\"header\");n.classList.add(\"appHeader\"),n.onmousedown=function(r){t.classList.contains(\"fullscreen\")||r.target==s||r.target==o||r.target==d||(e.dragY=r.pageY-t.offsetTop,e.dragX=r.pageX-t.offsetLeft,n.style.cursor=\"move\",e.dragging=!0,t.classList.add(\"dragging\"),e.DisableSelection(e.desktop.element),n.addEventListener(\"mouseleave\",i),n.addEventListener(\"mousemove\",function(n){e.dragging&&(t.style.top=n.clientY-e.dragY+\"px\",t.style.left=n.clientX-e.dragX+\"px\")}))};var i=function(i){i.clientY-e.dragY+200>window.innerHeight?t.style.top=window.innerHeight-200+\"px\":i.clientY-e.dragY<0&&(t.style.top=\"20px\"),i.clientX-e.dragX+200>window.innerWidth?t.style.left=window.innerWidth-200+\"px\":i.clientX-e.dragX<0&&(t.style.left=\"20px\"),e.dragging=!1,t.classList.remove(\"dragging\"),n.style.removeProperty(\"cursor\"),e.EnableSelection(e.desktop.element)};n.onmouseup=i;var r=document.createElement(\"img\");r.src=this.imageFolder+\"appIcons/\"+this.type+\".png\",r.alt=\"Icon\",r.ondragstart=function(){return!1},r.classList.add(\"appIcon\"),n.appendChild(r);var a=document.createElement(\"h2\");a.innerHTML=this.type,n.appendChild(a);var s=document.createElement(\"img\");s.classList.add(\"appController\"),s.alt=\"Close window\",s.src=this.imageFolder+\"closewindow.png\",s.onclick=function(){\"function\"==typeof e.ClearTimers&&e.ClearTimers(),document.querySelector(\"#desktopApplication\").removeChild(t)},n.appendChild(s);var o=document.createElement(\"img\");o.classList.add(\"appController\"),o.alt=\"Fullscreen\",o.src=this.imageFolder+\"fullsize.png\",o.onclick=function(){t.classList.contains(\"fullscreen\")?(t.style.left=e.xPos+\"px\",t.style.top=e.yPos+\"px\",void 0!==e.startWidth&&(t.style.width=e.startWidth+\"px\"),void 0!==e.startHeight&&(t.style.height=e.startHeight+\"px\")):(e.xPos=t.offsetLeft,e.yPos=t.offsetTop,t.style.removeProperty(\"width\"),t.style.removeProperty(\"height\"),t.style.removeProperty(\"top\"),t.style.removeProperty(\"left\")),t.classList.toggle(\"fullscreen\")},n.appendChild(o);var d=document.createElement(\"img\");d.classList.add(\"appController\"),d.alt=\"Minimize\",d.src=this.imageFolder+\"minimizewindow.png\",d.onclick=function(){e.desktop.hideApp(this,e.imageFolder+\"appIcons/\"+e.type+\"_Large.png\")},n.appendChild(d),t.appendChild(n);var c=document.createElement(\"main\");if(\"undefined\"!=typeof this.contextMenu){var p=document.createElement(\"div\");p.classList.add(\"Menu\"),this.contextMenu().forEach(function(e){var t=e;t.classList.add(\"hide\");var n=document.createElement(\"ul\");n.classList.add(\"contextMenu\");var i=document.createElement(\"a\");i.href=\"#\",i.innerHTML=t.dataset.name;var r=function(){t.classList.add(\"hide\"),document.documentElement.removeEventListener(\"mouseup\",r,!1)};i.onclick=function(e){e.preventDefault(),t.classList.remove(\"hide\"),document.documentElement.addEventListener(\"mouseup\",r,!1)},t.onclick=r,p.appendChild(n),n.appendChild(i),n.appendChild(t)}),c.appendChild(p)}if(this.app=document.createElement(\"div\"),c.appendChild(this.app),t.appendChild(c),e.statusBar=document.createElement(\"footer\"),e.statusBar.classList.add(\"statusBar\"),t.appendChild(e.statusBar),this.resizable){var l,u,m,h,g=function(e){l=e.clientX,u=e.clientY,m=parseInt(document.defaultView.getComputedStyle(t).width,10),h=parseInt(document.defaultView.getComputedStyle(t).height,10),document.documentElement.addEventListener(\"mousemove\",f,!1),document.documentElement.addEventListener(\"mouseup\",v,!1)},f=function(e){m+e.clientX-l<window.innerWidth-300&&(t.style.minWidth=m+e.clientX-l+\"px\"),h+e.clientY-u<window.innerHeight-200&&(t.style.minHeight=h+e.clientY-u+\"px\")},v=function(){document.documentElement.removeEventListener(\"mousemove\",f,!1),document.documentElement.removeEventListener(\"mouseup\",v,!1)},w=document.createElement(\"img\");w.alt=\"Resize\",w.src=this.imageFolder+\"resize.png\",w.className=\"resize noselect\",w.ondragstart=function(){return!1},w.addEventListener(\"mousedown\",g,!1),t.appendChild(w)}document.querySelector(\"#desktopApplication\").appendChild(t)},Window.prototype.setStatus=function(e){this.statusBar.innerHTML=e},Window.prototype.WindowConstruct=function(e,t,n,i,r){this.resizable=t,this.desktop=n,this.xPos=i,this.yPos=r,this.type=e,this.createHTML()},Window.prototype.DisableSelection=function(e){e.onselectstart=function(){return!1},e.unselectable=\"on\",e.style.MozUserSelect=\"none\",e.style.cursor=\"default\"},Window.prototype.EnableSelection=function(e){e.onselectstart=function(){return!0},e.unselectable=\"off\",e.style.MozUserSelect=\"text\",e.style.cursor=\"auto\"},window.onload=function(){new AppLoader(\"Loading your desktop...\"),new Desktop(\"desktopApplication\")};"]},{"start":{"row":0,"column":0},"end":{"row":2000,"column":2},"action":"insert","lines":["\"use strict\";","function AjaxCon(url, callback, posttype, params){","    var READY_STATE_UNINITIALIZED = 0;","    var READY_STATE_OPENED      = 1;","    var READY_STATE_SENT        = 2;","    var READY_STATE_LOADING     = 3;","    var READY_STATE_COMPLETE    = 4;","","    var  xhr = this.getXHR();","","    xhr.onreadystatechange = function(){","        if(xhr.readyState === READY_STATE_COMPLETE){","            if(xhr.status >= 200 && xhr.status < 300 || xhr.status === 304 || xhr.status === 400){","                callback(xhr.responseText);","            }else{","                console.log('Läsfel, status: ' + xhr.status);","            }","        }","    };","","    if(posttype === \"get\" || posttype === \"GET\"){","        xhr.open(\"get\", url, true);","        xhr.send(null)","","    }else{","        xhr.open(\"POST\", url, true);","        xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');","        xhr.send(params);","    }","","    this.abort = function(){","        xhr.abort();","    };","}","AjaxCon.prototype.getXHR            = function(){","    var xhr = null;","","    try{","        xhr = new XMLHttpRequest();","    }catch(error){","        try{","            xhr = new ActiveXObject(\"Microsoft.XMLHTTP\");","        }catch(error){","            throw new Error(\"No XHR object available\");","        }","    }","    return xhr;","};","/**"," * Created by Erik."," */","\"use strict\";","function AppLoader(header){","    var background = document.createElement(\"div\");","    background.classList.add(\"AppLoader\");","","    var h1 = document.createElement(\"h1\");","    h1.innerHTML = header;","    background.appendChild(h1);","","    var body = document.querySelector(\"body\");","    body.appendChild(background);","","    var container = document.createElement(\"div\");","    container.classList.add(\"container\");","    background.appendChild(container);","","    var progress = document.createElement(\"div\");","    progress.classList.add(\"progress\");","    container.appendChild(progress);","    setTimeout(function(){","        progress.classList.add(\"loading\");","","        setTimeout(function(){","            body.removeChild(background);","        }, 1250);","    }, 200);","}","/**"," * Created by Erik."," */","\"use strict\";","function Message(message, date, author){","    this.getText = function(){","        return message;","    };","","    this.setText = function(_text){","        message = _text;","    };","","    this.getDate = function(){","        return date;","    };","","    this.setDate = function(_date){","        date = _date;","    };","","    this.getAuthor = function(){","        return author;","    };","","    this.setAuthor = function(_author){","        author = _author;","    };","}","Message.prototype.getHTMLText       = function(){","    return this.getText();//.replace(/[\\n\\r]/g, \"</br>\");","};","Message.prototype.getDateText       = function(){","    var now = new Date();","    var milliseconds = now - this.getDate();","    var seconds = Math.round(milliseconds/1000);","    var minutes = Math.floor(seconds/60);","    var hours = Math.floor(minutes/60);","    var days = now.getUTCDate() - this.getDate().getUTCDate();","    var months = now.getUTCMonth() - this.getDate().getUTCMonth();","","    var formattedTime = this.getDate().getHours() + \":\" + (this.getDate().getMinutes() < 10 ? '0' : '') + this.getDate().getMinutes() + \":\" + (this.getDate().getSeconds() < 10 ? '0' : '') + this.getDate().getSeconds();","","    if(seconds < 60 && months < 1){","        return \"just now\";","    }","    else if(minutes == 1 && months === 0){","        return minutes + \" minute ago\";","    }","    else if(minutes < 60 && months === 0){","        return minutes + \" minutes ago\";","    }","    else if(days < 1 && months === 0){","        return \"Today \" + formattedTime;","    }","    else if(days < 2 && months === 0){","        return \"Yesterday \" + formattedTime;","    }","    else","    {","        return this.getDate().getUTCDate() + \"/\" + (this.getDate().getMonth() + 1) + \"-\" + this.getDate().getFullYear();","    }","};","","MessageBoard.prototype = new Window();","MessageBoard.prototype.constructor  = MessageBoard;","function MessageBoard(self, xPos, yPos) {","    this.WindowConstruct(\"Chat\", false, self, xPos, yPos);","","    this.title = 'Chat';","    this.app.classList.add(\"labbymezzage\");","    this.messages = [];","    this.imageLocation = \"images/chat\";","    this.timer = undefined;","","    var settings = this.getCookie();","","    if(typeof settings === \"object\"){","        this.refreshRate = settings[0];","        this.username = settings[1];","        this.history = settings[2];","    }else{","        this.refreshRate = 10000;","        this.username = \"Anonymous\";","        this.history = 20;","    }","","    this.connection = undefined;","","    //Run methods on creation","    this.CreateHTMLLayout();","    this.getMessagesFromServer();","}","MessageBoard.prototype.ClearTimers              = function(){","    clearInterval(this.timer);","    if(typeof this.connection !== \"undefined\") {","        this.connection.abort();","    }","};","MessageBoard.prototype.CreateHTMLLayout         = function(){","    var that = this;","","    var labbyMain = document.createElement(\"div\");","    labbyMain.className = \"labbyMezzageArea\";","    this.app.appendChild(labbyMain);","","    var labbymezzageCount = document.createElement(\"div\");","    labbymezzageCount.className = \"labbyMezzageCount\";","    this.app.appendChild(labbymezzageCount);","","    var labbyTextArea = document.createElement(\"textarea\");","    labbyTextArea.className = \"labbyMezzageContent\";","    labbyTextArea.onkeypress = function(e){","        if(e.keyCode == 13){","            if(!e.shiftKey){","                e.preventDefault();","                that.addMessage();","            }","        }","    };","","    this.app.appendChild(labbyTextArea);","","    var labbySubmit = document.createElement(\"button\");","    labbySubmit.className = \"submitBtn\";","    var submitText = document.createTextNode(\"Send\");","    labbySubmit.appendChild(submitText);","","    this.app.appendChild(labbySubmit);","","    labbySubmit.onclick = function(){","        that.addMessage();","        that.app.getElementsByClassName(\"labbyMezzageContent\")[0].focus();","    };","};","MessageBoard.prototype.numberOfMessages         = function(){","    return this.messages.length + \" messages\";","};","MessageBoard.prototype.renderMessage            = function(message){","    var messageMain = document.createElement(\"section\");","","    var author = document.createElement(\"p\");","    author.innerHTML = \"Skrivet av: \" + message.getAuthor();","    messageMain.appendChild(author);","","    var messageText = document.createElement(\"p\");","    messageText.innerHTML = message.getHTMLText();","    messageMain.appendChild(messageText);","","    var messageDate = document.createElement(\"date\");","    messageDate.innerHTML = message.getDateText();","","    messageMain.appendChild(messageDate);","","    return messageMain;","};","MessageBoard.prototype.getMessagesFromServer    = function(){","    var self = this, timer;","    var loadMessages = function(response){","        clearTimeout(timer);","        var parseXml;","        self.messages = [];","        if (typeof window.DOMParser != \"undefined\") {","            parseXml = function(xmlStr) {","                return ( new window.DOMParser() ).parseFromString(xmlStr, \"text/xml\");","            };","        } else if (typeof window.ActiveXObject != \"undefined\" &&","            new window.ActiveXObject(\"Microsoft.XMLDOM\")) {","            parseXml = function(xmlStr) {","                var xmlDoc = new window.ActiveXObject(\"Microsoft.XMLDOM\");","                xmlDoc.async = \"false\";","                xmlDoc.loadXML(xmlStr);","                return xmlDoc;","            };","        } else {","            throw new Error(\"No XML parser found\");","        }","","        var date = new Date();","        var minute = (date.getMinutes() < 10) ? \"0\" + date.getMinutes() : date.getMinutes();","        var seconds = (date.getSeconds() < 10) ? \"0\" + date.getSeconds() : date.getSeconds();","        self.setStatus(\"Uppdaterad \" + date.getHours() + \":\" + minute + \":\" + seconds);","","        var xml = parseXml(response);","        var messages = xml.getElementsByTagName(\"message\");","        for(var i = 0; i < messages.length; i++){","            var message = messages[i];","            var text = message.querySelector(\"text\").innerHTML;","            var time = message.querySelector(\"time\").innerHTML;","            var author = message.querySelector(\"author\").innerHTML;","            var id = message.querySelector(\"id\").innerHTML;","            self.messages.push(new Message(text, new Date(parseInt(time)), author));","        }","        self.renderMessages();","    };","    self.setStatus(\"Retrieving messages\");","    timer = setTimeout(function(){","        self.setStatus(\"Laddar meddelanden...<img src='images/loader_white.gif'>\");","    }, 100);","    var history = (self.history !== undefined) ? \"?history=\" + self.history : \"\";","    self.connection = new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyserver/getMessage.php\" + history, loadMessages, \"GET\");","","    this.timer = setInterval(function(){","        timer = setTimeout(function(){","            self.setStatus(\"Laddar meddelanden...<img src='images/loader_white.gif'>\");","        }, 100);","        self.connection = new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyserver/getMessage.php\" + history, loadMessages, \"GET\");","    }, self.refreshRate)","};","MessageBoard.prototype.renderMessages           = function(){","","    var messageArea = this.app.getElementsByClassName(\"labbyMezzageArea\")[0];","    var messageCount = this.app.getElementsByClassName(\"labbyMezzageCount\")[0];","","    messageArea.innerHTML = \"\";","    var count = 0;","","    var that = this;","","    this.messages.forEach(function (message) {","        messageArea.appendChild(that.renderMessage(message, count));","        count++;","    });","    messageCount.innerHTML = this.numberOfMessages();","    this.scrollToBottom();","};","MessageBoard.prototype.scrollToBottom           = function(){","    var messageArea = this.app.getElementsByClassName(\"labbyMezzageArea\")[0];","    messageArea.scrollTop = messageArea.scrollHeight;","};","MessageBoard.prototype.addMessage               = function(){","    var self = this;","    var textArea = this.app.getElementsByClassName(\"labbyMezzageContent\")[0];","    var handleCallback = function(response){","        console.log(response);","        textArea.value = '';","        self.ClearTimers();","        self.getMessagesFromServer();","        self.scrollToBottom();","    };","    if(textArea.value != \"\") {","        /*var string = ({","         username: self.username,","         text: textArea.value","         });*/","        // new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyserver/setMessage.php\", handleCallback, \"POST\", string);","        $.ajax({","            type: \"POST\",","            url: \"http://homepage.lnu.se/staff/tstjo/labbyserver/setMessage.php\",","            data: ({","                username: self.username,","                text: textArea.value","            }),","            success: handleCallback","        });","    }","};","MessageBoard.prototype.contextMenu              = function(){","    var that = this;","","    var option1 = document.createElement(\"ul\");","    option1.dataset.name = \"Settings\";","","    var level = document.createElement(\"li\");","    var aTag = document.createElement(\"a\");","    aTag.href = \"#\";","    aTag.innerHTML = \"<img src='images/user.png'> Nickname\";","    aTag.onclick = function(e){","        e.preventDefault();","        that.getNickSetting();","    };","    level.appendChild(aTag);","    option1.appendChild(level);","","    level = document.createElement(\"li\");","    aTag = document.createElement(\"a\");","    aTag.href = \"#\";","    aTag.innerHTML = \"<img src='images/interval.png'> Time interval\";","    aTag.onclick = function(e){","        e.preventDefault();","        that.getIntervalSetting();","    };","    level.appendChild(aTag);","    option1.appendChild(level);","","    level = document.createElement(\"li\");","    aTag = document.createElement(\"a\");","    aTag.href = \"#\";","    aTag.innerHTML = \"<img src='images/messages.png'> Number of messages\";","    aTag.onclick = function(e){","        e.preventDefault();","        that.getHistorySetting();","    };","    level.appendChild(aTag);","    option1.appendChild(level);","","    level = document.createElement(\"li\");","    aTag = document.createElement(\"a\");","    aTag.href = \"#\";","    aTag.innerHTML = \"<img src='images/refresh.png'> Refresh\";","    aTag.onclick = function(e){","        e.preventDefault();","        that.ClearTimers();","        that.getMessagesFromServer();","    };","    level.appendChild(aTag);","    option1.appendChild(level);","","    return [option1];","};","MessageBoard.prototype.getIntervalSetting       = function(){","    var self = this;","","    var popup = document.createElement(\"div\");","    popup.classList.add(\"popup\");","","    var close = document.createElement(\"a\");","    close.href = \"#\";","    var closeImg = document.createElement(\"img\");","    closeImg.src = \"images/closewindow.png\";","    close.appendChild(closeImg);","    close.onclick = function(e){","        e.preventDefault();","        self.app.parentNode.removeChild(popup);","    };","    popup.appendChild(close);","","    var input = document.createElement(\"select\");","    var rates = [[10000, \"10 sekunder\"], [15000, \"15 sekunder\"], [30000, \"30 sekunder\"], [60000, \"1 minut\"], [300000, \"5 minuter\"], [600000, \"10 minuter\"]];","    input.innerHTML = \"\";","    rates.forEach(function(rate){","        var selected = (rate[0] == self.refreshRate) ? \" selected\" : \"\";","        input.innerHTML += \"<option value='\" + rate[0] + \"'\" + selected + \">\" + rate[1] + \"</option>\";","    });","","    popup.appendChild(input);","","    var submit = document.createElement(\"button\");","    submit.innerHTML = \"Ändra\";","    submit.onclick = function(){","        self.ClearTimers();","        self.refreshRate = input.value;","        self.createCookie();","        self.getMessagesFromServer();","        self.app.parentNode.removeChild(popup);","    };","    popup.appendChild(submit);","","    this.app.parentNode.appendChild(popup);","};","MessageBoard.prototype.getHistorySetting        = function(){","    var self = this;","","    var popup = document.createElement(\"div\");","    popup.classList.add(\"popup\");","","    var close = document.createElement(\"a\");","    close.href = \"#\";","    var closeImg = document.createElement(\"img\");","    closeImg.src = \"images/closewindow.png\";","    close.appendChild(closeImg);","    close.onclick = function(e){","        e.preventDefault();","        self.app.parentNode.removeChild(popup);","    };","    popup.appendChild(close);","","    var input = document.createElement(\"select\");","    var rates = [[5, \"5 meddelanden\"], [10, \"10 meddelanden\"], [20, \"20 meddelanden\"], [50, \"50  meddelanden\"], [undefined, \"Alla  meddelanden\"]];","    input.innerHTML = \"\";","    rates.forEach(function(rate){","        var selected = (rate[0] == self.history) ? \" selected\" : \"\";","        input.innerHTML += \"<option value='\" + rate[0] + \"'\" + selected + \">\" + rate[1] + \"</option>\";","    });","","    popup.appendChild(input);","","    var submit = document.createElement(\"button\");","    submit.innerHTML = \"Ändra\";","    submit.onclick = function(){","        self.ClearTimers();","        self.history = input.value;","        self.createCookie();","        self.getMessagesFromServer();","        self.app.parentNode.removeChild(popup);","    };","    popup.appendChild(submit);","","    this.app.parentNode.appendChild(popup);","};","MessageBoard.prototype.getNickSetting           = function(){","    var self = this;","","    var popup = document.createElement(\"div\");","    popup.classList.add(\"popup\");","","    var close = document.createElement(\"a\");","    close.href = \"#\";","    var closeImg = document.createElement(\"img\");","    closeImg.src = \"images/closewindow.png\";","    close.appendChild(closeImg);","    close.onclick = function(e){","        e.preventDefault();","        self.app.parentNode.removeChild(popup);","    };","    popup.appendChild(close);","","    var input = document.createElement(\"input\");","    input.type = \"text\";","    input.value = self.username;","","    popup.appendChild(input);","","    var submit = document.createElement(\"button\");","    submit.innerHTML = \"Ändra\";","    submit.onclick = function(){","        self.username = input.value;","        self.createCookie();","        self.app.parentNode.removeChild(popup);","    };","    popup.appendChild(submit);","","    this.app.parentNode.appendChild(popup);","    input.focus();","    input.select();","};","MessageBoard.prototype.createCookie             = function(){","    var name = \"setting\";","    var value = this.refreshRate + \",\" + this.username + \",\" + this.history;","    var days = 1;","","    var expires;","    if (days) {","        var date = new Date();","        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));","        expires = \"; expires=\" + date.toGMTString();","    }","    else {","        expires = \"\";","    }","    document.cookie = name + \"=\" + value + expires + \"; path=/\";","};","MessageBoard.prototype.getCookie                = function(){","    var c_name = \"setting\";","    if (document.cookie.length > 0) {","        var c_start = document.cookie.indexOf(c_name + \"=\");","        if (c_start != -1) {","            c_start = c_start + c_name.length + 1;","            var c_end = document.cookie.indexOf(\";\", c_start);","            if (c_end == -1) {","                c_end = document.cookie.length;","            }","","            return decodeURI(document.cookie.substring(c_start, c_end)).split(',');","","        }","    }","    return \"\";","};","\"use strict\";","function Desktop(id){","    this.windows = [];","    this.minimizedApps = 0;","    this.element = document.getElementById(id);","    this.element.classList.add(\"desktop\");","    this.navbar = document.createElement(\"nav\");","    var self = this;","","    var getPositionX = function(){","        var position = 30 * self.windows.length + 30;","        if(position / (window.innerWidth - 200) > 1){","            return position - (Math.floor(position / (window.innerWidth - 200)) * (window.innerWidth - 200));","        }else{","            return 30 * self.windows.length + 30;","        }","    };","    var getPositionY = function () {","        var position = 30 * self.windows.length + 30;","        if(position / (window.innerHeight - 300) > 1){","            return position - (Math.floor(position / (window.innerHeight - 300)) * (window.innerHeight - 300));","        }else{","            return 30 * self.windows.length + 30;","        }","    };","","    this.element.appendChild(this.navbar);","","    var applications = [","        [MemoryGame, \"images/appIcons/Memory_Large.png\", \"Memory\"],","        [Minesweeper, \"images/appIcons/Minesweeper_Large.png\", \"Minesweeper\"],","        [QuizWindow, \"images/appIcons/Quiz_Large.png\",\"Quiz\"],","        [QuoteWindow, \"images/appIcons/Quote_Large.png\",\"Quotes\"],","        [MessageBoard, \"images/appIcons/Chat_Large.png\",\"Chat\"],","        [RSSWindow, \"images/appIcons/RSS_Large.png\", \"RSS\"],","        [GalleryWindow, \"images/appIcons/Gallery_Large.png\", \"Gallery\"],","        [NoteWindow, \"images/appIcons/Note_Large.png\", \"Note\"]","    ];","","    applications.forEach(function(app){","        var aTag = document.createElement(\"a\");","        aTag.href = \"#\";","        aTag.classList.add(\"appLauncher\");","        aTag.onclick = function(e){","            e.preventDefault();","            self.windows.push(new app[0](self, getPositionX(), getPositionY()));","        };","","        var image = document.createElement(\"img\");","        image.src = app[1];","        aTag.appendChild(image);","","        var title = document.createElement(\"span\");","        title.innerHTML = app[2];","        aTag.appendChild(title);","","        self.element.appendChild(aTag);","    });","","    this.hideApp = function(application, url){","        self.navbar.classList.add(\"showNav\");","        application = application.parentNode.parentNode;","        application.classList.add(\"hidden\");","","        self.minimizedApps++;","        var appImage = document.createElement(\"img\");","        appImage.src = url;","        appImage.className = \"minimizedWindow\";","        appImage.onclick = function(){","            application.classList.remove(\"hidden\");","            self.navbar.removeChild(appImage);","","            if(--self.minimizedApps <= 0){","                self.navbar.classList.remove(\"showNav\");","            }","        };","        self.navbar.appendChild(appImage);","    };","}","/**"," * Created by Erik."," */","\"use strict\";","","ImageWindow.prototype = new Window();","ImageWindow.prototype.constructor = ImageWindow;","function ImageWindow(url, desktop, xPos, yPos) {","    var image = document.createElement(\"img\");","    image.src = url;","","    this.WindowConstruct(\"Gallery\", false, desktop, xPos, yPos);","    this.app.appendChild(image);","}","","GalleryWindow.prototype = new Window();","GalleryWindow.prototype.constructor = GalleryWindow;","function GalleryWindow(desktop, xPos, yPos) {","    this.WindowConstruct(\"Gallery\", false, desktop, xPos, yPos);","","    this.Url = \"http://homepage.lnu.se/staff/tstjo/labbyServer/imgviewer/\";","    this.thumbWidth = 0;","    this.thumbHeight = 0;","    this.timer = undefined;","    this.imageArr = undefined;","    this.app.classList.add(\"Gallery\");","    this.OpenInNewWindow = function(url){","        new ImageWindow(url, desktop, xPos+5, yPos+5);","    };","    this.loadImages();","}","GalleryWindow.prototype.render      = function(){","    var self = this;","    this.imageArr.forEach(function(currentImage){","        var imageContainer = document.createElement(\"a\");","        imageContainer.href=\"#\";","        imageContainer.style.width = self.thumbWidth + \"px\";","        imageContainer.style.height = self.thumbHeight + \"px\";","        imageContainer.classList.add(\"imageContainer\");","        imageContainer.onclick = function(e){","            e.preventDefault();","            self.OpenInNewWindow(currentImage.URL);","        };","        imageContainer.onmouseover = function(){","            self.setStatus(\"Bildstorlek: \" + currentImage.width + \"px X \" + currentImage.height + \"px\");","        };","        imageContainer.onmouseleave = function(){","            self.setStatus(\"\");","        };","","        var image = document.createElement(\"img\");","        image.src = currentImage.thumbURL;","","        imageContainer.appendChild(image);","        self.app.appendChild(imageContainer);","    });","};","GalleryWindow.prototype.loadImages  = function(){","    var timer, self = this;","","    var handler = function(response){","        //self.setStatus(\"Retrieved images from server\");","        clearTimeout(timer);","        self.setStatus(\"Bilder laddade!\");","        self.imageArr = JSON.parse(response);","        for(var i=0; i < self.imageArr.length; i++){","            if(self.imageArr[i].thumbWidth > self.thumbWidth){","                self.thumbWidth = self.imageArr[i].thumbWidth;","            }","            if(self.imageArr[i].thumbHeight > self.thumbHeight){","                self.thumbHeight = self.imageArr[i].thumbHeight;","            }","        }","        self.render()","    };","    self.setStatus(\"Laddar bilder...\");","    timer = setTimeout(function(){","        self.setStatus(\"Laddar bilder...<img src='images/loader_white.gif'>\");","    }, 1500);","    new AjaxCon(this.Url, handler, \"GET\");","};","/**"," * Created by Erik."," */","\"use strict\";","","MemoryGame.prototype = new Window();","MemoryGame.prototype.constructor = MemoryGame;","function MemoryGame(self, xPos, yPos) {","    var rows = 2, cols = 4;","","    this.WindowConstruct(\"Memory\", false, self, xPos, yPos);","","    this.app.classList.add(\"GameOn-Memory\");","    this.imageLocation = \"images/memory/\";","","    this.getRows = function(){return rows;};","    this.setRows = function(value){rows = value;};","","    this.getCols = function(){return cols;};","    this.setCols = function(value){cols = value;};","","    this.isActive = false;","","    this.flippedImage, this.pictureArray, this.structuredArray, this.flippedCards, this.turnCounter;","    this.resetGame([this.getRows(), this.getCols()]);","}","MemoryGame.prototype.resetGame              = function(settings){","    var RandomGenerator = {","","        /*","         Denna metod tar antalet rader och columner som inparameter.","","         Metoden returnerar en array inneh�llandes utslumpade tal mellan 1 och (rows*cols)/2. Varje tal representeras tv�","         g�nger och motsvarar s�ledes en spelbricka.","","         I en 4*4 matris kan Arrayen t.ex. se ut s� h�r:","         [1,2,6,8,6,2,5,3,1,3,7,5,8,4,4,7]","","         I en 2*4 matris kan Arrayen t.ex. se ut s� h�r:","         [3,4,4,1,2,1,2,3]","         */","","        getPictureArray: function(rows, cols)","        {","            var numberOfImages = rows*cols;","            var maxImageNumber = numberOfImages/2;","","            var imgPlace = [];","","            //Utplacering av bilder i Array","            for(var i=0; i<numberOfImages; i++)","                imgPlace[i] = 0;","","            for(var currentImageNumber=1; currentImageNumber<=maxImageNumber; currentImageNumber++)","            {","                var imageOneOK = false;","                var imageTwoOK = false;","","                do","                {","                    if(imageOneOK == false)","                    {","                        var randomOne = Math.floor( (Math.random() * (rows*cols-0) + 0) );","","                        if( imgPlace[randomOne] == 0 )","                        {","                            imgPlace[randomOne] = currentImageNumber;","                            imageOneOK = true;","                        }","                    }","","                    if(imageTwoOK == false)","                    {","                        var randomTwo = Math.floor( (Math.random() * (rows*cols-0) + 0) );","","                        if( imgPlace[randomTwo] == 0 )","                        {","                            imgPlace[randomTwo] = currentImageNumber;","                            imageTwoOK = true;","                        }","                    }","                }","                while(imageOneOK == false || imageTwoOK == false);","            }","","            return imgPlace;","        }","    };","    if(settings[0] !== undefined){","        this.setRows(settings[0]);","    }","    if(settings[1] !== undefined){","        this.setCols(settings[1]);","    }","    this.app.innerHTML = '';","    this.pictureArray = RandomGenerator.getPictureArray(this.getRows(), this.getCols());","    this.structuredArray = this.getStructuredArray();","    this.flippedImage = undefined;","    this.flippedCards = [];","    this.turnCounter = 0;","    this.renderBoard();","};","MemoryGame.prototype.renderBoard            = function(){","    var div, a, img;","    var that = this;","","    this.structuredArray.forEach(function(row){","        div = document.createElement(\"div\");","        div.className = \"row\";","","        row.forEach(function(col){","            a = document.createElement(\"a\");","            a.href = \"#\";","            img = document.createElement(\"img\");","            img.src = that.imageLocation + \"0.png\";","            a.appendChild(img);","            a.onclick = function(e){","                e.preventDefault();","                if(that.isActive === false && that.flippedCards.indexOf(col['value']) !== 0) {","                    that.flipCards(this, col);","                }","            };","            div.appendChild(a);","        });","        that.app.appendChild(div);","    });","};","MemoryGame.prototype.getStructuredArray     = function(){","    var rows, cols;","    var output = [];","    for(rows = 0; rows < this.getRows(); rows++){","        output[rows] = [];","        for(cols = 0; cols < this.getCols(); cols++){","            output[rows][cols] = [];","            output[rows][cols]['value'] = this.pictureArray[(this.getCols() * rows) + cols];","            output[rows][cols]['id'] = (this.getCols() * rows) + cols;","        }","    }","    return output;","};","MemoryGame.prototype.getSettings            = function(header, body) {","    var div = document.createElement(\"div\");","    div.className = \"overlay\";","","    var h = document.createElement(\"h1\");","    h.innerHTML = header;","    div.appendChild(h);","","    var p = document.createElement(\"p\");","    p.innerHTML = body;","    div.appendChild(p);","","    var button = document.createElement(\"button\");","    button.innerHTML = \"Starta spel\";","    var that = this;","    button.onclick = function(){","        that.resetGame([that.getRows(), that.getCols()]);","    };","    div.appendChild(button);","","    this.app.appendChild(div);","};","MemoryGame.prototype.flipCards              = function(aTag, col){","    var img;","","    img = aTag.firstChild;","","    var that = this;","    that.isActive = true;","","    img.className = \"flipped\";","","    setTimeout(function () {","        img.src = that.imageLocation + col['value'] + \".png\";","","        if (that.flippedImage === undefined) {","            that.flippedImage = [];","            that.flippedImage['element'] = img;","            that.flippedImage['value'] = col['value'];","            that.isActive = false;","        } else {","            that.isActive = true;","            if (that.flippedImage['element'] != img && that.flippedImage['value'] === col['value']) {","                that.turnCounter++;","                that.flippedCards.push(col['value']);","                if(that.flippedCards.length >= (that.pictureArray.length/2)){","                    that.getSettings(\"Grattis!\", \"Du klarade av spelet på \" + that.turnCounter + \" omgångar, vill du spela igen?\");","                }","                that.flippedImage = undefined;","                that.isActive = false;","            } else if (that.flippedImage['element'] === img) {","                that.isActive = false;","            }","            else {","                that.turnCounter++;","                setTimeout(function () {","                    var images = [img, that.flippedImage['element']];","                    images.forEach(function(im){","                        im.className  = \"\";","                        setTimeout(function () {","                            im.src = that.imageLocation + \"0.png\";","                        }, 125);","                    });","                    that.flippedImage = undefined;","                    that.isActive = false;","                }, 500);","            }","","        }","    }, 125);","","};","MemoryGame.prototype.contextMenu            = function(){","    var that = this;","","    var option1 = document.createElement(\"ul\");","    option1.dataset.name = \"Options\";","","    var level = document.createElement(\"li\");","    var aTag = document.createElement(\"a\");","    aTag.href = \"#\";","    aTag.innerHTML = \"<img src='images/refresh.png'> Reset\";","    aTag.onclick = function(e){","        e.preventDefault();","        that.resetGame([that.getRows(), that.getCols()]);","    };","    level.appendChild(aTag);","    option1.appendChild(level);","","","    var option2 = document.createElement(\"ul\");","    var difficulties = [[1,4],[2,4],[3,4],[4,4]];","","    option2.dataset.name = \"Difficulties\";","    difficulties.forEach(function(difficulty){","        level = document.createElement(\"li\");","        aTag = document.createElement(\"a\");","        aTag.href = \"#\";","        aTag.innerHTML = \"<img src='images/tiles.png'> \" + difficulty[0] + \"x\" + difficulty[1];","        aTag.onclick = function(e){","            e.preventDefault();","            that.resetGame(difficulty);","        };","        level.appendChild(aTag);","        option2.appendChild(level);","    });","    return [option1, option2];","};","","/**"," * Created by Erik."," */","\"use strict\";","","Minesweeper.prototype = new Window();","Minesweeper.prototype.constructor = Minesweeper;","function Minesweeper(self, xPos, yPos) {","    this.difficulties = [[\"Beginner\", 9], [\"Intermidiate\", 15], [\"Expert\", 20]];","","    this.WindowConstruct(\"Minesweeper\", false, self, xPos, yPos);","","    this.app.classList.add(\"GameOn-Minesweeper\");","    this.imagePrefix = \"images/minesweeper/\";","    this.GameWidth = 9;","    this.PictureWidth = 20;","","    this.gameOver, this.board = [], this.numberOfMines, this.mines, this.turnedImages, this.markedImages, this.timer, this.clock, this.bombsCounter;","    this.startGame();","}","Minesweeper.prototype.ClearTimers       = function(){","    clearInterval(this.timer);","};","Minesweeper.prototype.startGame         = function(){","    this.setDefaultValues();","    this.drawGame();","    this.calculateMines();","};","Minesweeper.prototype.resetGame         = function(){","    this.resetAllTiles();","    this.setDefaultValues();","    this.bombsCounter.innerHTML = this.numberOfMines;","    this.calculateMines();","    this.startTimer();","};","Minesweeper.prototype.setDefaultValues  = function(){","    this.gameOver = false;","    this.numberOfMines = Math.floor(this.GameWidth*this.GameWidth *0.25);","    this.mines = [];","    this.turnedImages = 0;","    this.markedImages = 0;","};","Minesweeper.prototype.drawGame          = function(){","    var that = this;","    var i;","    that.app.innerHTML = '';","","    function clicked(e){","        e.preventDefault();","        if(that.gameOver === false) {","            var col = Math.floor((e.pageX -this.getBoundingClientRect().left) / that.PictureWidth);","            var row = Math.floor((e.pageY -this.getBoundingClientRect().top) / that.PictureWidth);","            if (that.isTurned(row, col) === false) {","                if (e.which === 3) {                                //Right-click","                    if(that.isMarked(row, col) === false) {             //Set marker","                        that.setMarker(row, col);","                    }else if(that.isMarked(row, col) === true) {        //Remove marker","                        that.removeMarker(row, col);","                    }","                } else {                                            //Left-click","                    if (that.hasMine(row, col)) {                       //MINE! Game over :(","                        that.mines.forEach(function (mine) {","                            that.setImage(mine[0], mine[1], that.imagePrefix + \"bomb.png\");","                        });","                        that.setImage(row, col, that.imagePrefix + \"bombred.png\");","                        clearTimeout(that.timer);","                        that.gameOver = true;","                    }else {                                             //Show tiles","                        that.showEmptyTiles(row, col);","                    }","                }","                that.bombsCounter.innerHTML = that.numberOfMines - that.markedImages;   //Update marker counter","                if (that.markedImages + that.turnedImages >= that.GameWidth * that.GameWidth && that.markedImages === that.numberOfMines) { //Are we there yet?","                    alert('Congratz! You won!');","                    clearTimeout(that.timer);","                    that.gameOver = true;","","                }","            }","        }","    }","","    var gameArea = document.createElement(\"div\");                           //Game area","    this.app.style.width = this.GameWidth * this.PictureWidth + \"px\";","    gameArea.style.width = this.GameWidth * this.PictureWidth + \"px\";           //Set size according to #tiles and size of tiles","    gameArea.onclick = clicked;                                                 //Left-click","    gameArea.addEventListener('contextmenu', clicked);                              //Right-click","","    var header = document.createElement(\"header\");                          //Header","","    var newButton = document.createElement(\"button\");                           //New game button","    newButton.innerHTML = \"New Game\";","    newButton.onclick = function(){","        that.resetGame();","    };","","    this.bombsCounter = document.createElement(\"div\");                              //Remaining bomb counter","    this.bombsCounter.className = \"bombsLeft\";","    this.bombsCounter.innerHTML = this.numberOfMines;","","    this.clock = document.createElement(\"div\");                                  //Timer","    this.clock.className = \"timer\";","","    this.startTimer();","","    header.appendChild(this.bombsCounter);","    header.appendChild(newButton);","    header.appendChild(this.clock);","    this.app.appendChild(header);","    this.app.appendChild(gameArea);","","    this.board = [];","","    for(i = 0; i < this.GameWidth; i++){                                        //Render HTML and create array","        var row = document.createElement(\"div\");                                // with elements","        row.className = \"row\";","","        var imageArray = [];","","        for(var j = 0; j < this.GameWidth; j++){","            var img = document.createElement(\"img\");","            img.src = this.imagePrefix + \"standard.png\";","            row.appendChild(img);","            imageArray.push({","                image: img,","                mine: false,","                turned: false,","                marked: false","            });","        }","","        this.board.push({","            rowDiv: row,","            rowArray: imageArray","        });","        gameArea.appendChild(row);","    }","","};","Minesweeper.prototype.resetAllTiles     = function(){","    var that = this,i,j;","","    for(i = 0; i < this.GameWidth; i++) {","        for (var j = 0; j < this.GameWidth; j++) {","            var tile = this.board[i].rowArray[j];","            tile.mine = false;","            tile.turned = false;","            tile.marked = false;","","            if(tile.image.src.split('/').indexOf('standard.png') < 0){","                tile.image.src = that.imagePrefix + \"standard.png\";","            }","        }","    }","};","Minesweeper.prototype.calculateMines    = function(){                              //Calculate position of mines","    for(var i = 0; i < this.numberOfMines; i++){","        var mineRow = Math.floor((Math.random() * this.GameWidth));","        var mineCol = Math.floor((Math.random() * this.GameWidth));","","        if(this.hasMine(mineRow, mineCol) === false){","            this.setMine(mineRow, mineCol);","            this.mines.push([mineRow, mineCol]);","        }else{","            i--;","        }","    }","};","Minesweeper.prototype.startTimer        = function(){","    clearTimeout(this.timer);","    var that = this;","    this.clock.innerHTML = 0;","    var time = 1;","    this.timer = setInterval(function(){                                       //Interval","        that.clock.innerHTML = time;","        time++;","    }, 1000);","};","Minesweeper.prototype.contextMenu       = function(){","    var that = this;","    var ul = document.createElement(\"ul\");","    ul.dataset.name = \"Difficulties\";","    that.difficulties.forEach(function(difficulty){","        var level = document.createElement(\"li\");","        var aTag = document.createElement(\"a\");","        aTag.href = \"#\";","        aTag.innerHTML = difficulty[0];","        aTag.onclick = function(){","            that.GameWidth = difficulty[1];","            that.startGame();","        };","        level.appendChild(aTag);","        ul.appendChild(level);","    });","    return [ul];","};","Minesweeper.prototype.showEmptyTiles    = function(row, col){                 //Recursive function to show empty tiles","    if(row >= this.GameWidth || row < 0 || col >= this.GameWidth || col < 0 || this.isTurned(row, col) === true || this.hasMine(row,col)) {","        return;","    }","    this.turnImage(row, col);","    this.turnedImages++;","    if(this.hasNeighborMines(row, col) > 0){","        this.setImage(row, col, this.imagePrefix + this.hasNeighborMines(row, col) + \".png\");","        return;","    }","    this.setImage(row, col, this.imagePrefix + \"empty.png\");","    this.showEmptyTiles(row-1, col);","    this.showEmptyTiles(row-1, col+1);","    this.showEmptyTiles(row-1, col-1);","    this.showEmptyTiles(row+1, col);","    this.showEmptyTiles(row+1, col+1);","    this.showEmptyTiles(row+1, col-1);","    this.showEmptyTiles(row, col-1);","    this.showEmptyTiles(row, col+1);","","};","Minesweeper.prototype.isMarked          = function(row, col){","    return this.board[row].rowArray[col].marked;","};","Minesweeper.prototype.setMarker         = function(row, col){","    this.board[row].rowArray[col].marked = true;","    if(this.markedImages < this.numberOfMines) {","        this.markedImages++;","        this.setImage(row, col, this.imagePrefix + \"marked.png\");","    }","};","Minesweeper.prototype.removeMarker      = function(row, col){","    this.board[row].rowArray[col].marked = false;","    if(this.markedImages > 0) {","        this.markedImages--;","        this.setImage(row, col, this.imagePrefix + \"standard.png\");","    }","};","Minesweeper.prototype.hasMine           = function(row, col){","    return this.board[row].rowArray[col].mine;","};","Minesweeper.prototype.isTurned          = function(row, col){","    return this.board[row].rowArray[col].turned;","};","Minesweeper.prototype.turnImage         = function(row, col){","    if(this.isMarked(row,col)){","        this.removeMarker(row,col);","    }","    this.board[row].rowArray[col].turned = true;","};","Minesweeper.prototype.setImage          = function(row, col, imagePath){","    this.board[row].rowArray[col].image.src = imagePath;","};","Minesweeper.prototype.setMine           = function(row, col){","    this.board[row].rowArray[col].mine = true;","};","Minesweeper.prototype.hasNeighborMines  = function(row, col){","    var count = 0, i, j;","    for(i = row-1; i <= row+1; i++){","        for(j = col-1; j <= col+1; j++){","            if((i < this.GameWidth && i >= 0) && (j < this.GameWidth && j >= 0)){","                if(this.hasMine(i, j)){","                    count++;","                }","            }","        }","    }","    return count;","};","/**"," * Created by Erik."," */","\"use strict\";","","NoteWindow.prototype = new Window();","NoteWindow.prototype.constructor = NoteWindow;","function NoteWindow(self, xPos, yPos) {","    this.startHeight = 300;","    this.startWidth = 300;","    this.WindowConstruct(\"Note\", true, self, xPos, yPos);","    this.render();","}","NoteWindow.prototype.render = function(){","    var self = this;","    self.app.classList.add(\"Note\");","","    var textarea = document.createElement(\"textarea\");","","    self.app.parentNode.style.position = \"absolute\";","    self.app.parentNode.style.right = \"0\";","    self.app.parentNode.style.left = \"0\";","    self.app.parentNode.style.top = \"0\";","    self.app.parentNode.style.bottom = \"0\";","    self.app.appendChild(textarea);","    textarea.focus();","};","","/**"," * Created by Erik."," */","\"use strict\";","","QuizWindow.prototype = new Window();","QuizWindow.prototype.constructor = QuizWindow;","function QuizWindow(self, xPos, yPos) {","    this.WindowConstruct(\"Quiz\", false, self, xPos, yPos);","    this.app = this.app;","    this.nextURL;","    this.moreQuestions = true;","    this.questionsArr;","","    this.init();","}","QuizWindow.prototype.getScore       = function(){","    var that = this;","","    var game = this.app.querySelector(\".workArea\");","    game.innerHTML = '';","    var scoreBoard = document.createElement(\"div\");","    scoreBoard.className = \"questionList\";","    game.appendChild(scoreBoard);","","    var score = 0;","    for(var i = 0; i < this.questionsArr.length; i++){","        var container = document.createElement(\"section\");","        container.className = \"result\";","        if(this.questionsArr[i].response === \"Correct answer!\" && this.questionsArr[i].tries === 1){","            score++;","            container.classList.add(\"correct\");","        }else if(this.questionsArr[i].response === \"Wrong answer! :(\" || this.questionsArr[i].tries > 1){","            container.classList.add(\"incorrect\");","        }","","        var question = document.createElement(\"header\");","        var span = document.createElement(\"span\");","        span.innerHTML = this.questionsArr[i].question;","        question.appendChild(span);","","        var arrow = document.createElement(\"img\");","        arrow.src = \"images/quiz/arrow.svg\";","        arrow.alt = \"Arrow\";","        if(container.classList.contains(\"incorrect\")  || this.questionsArr[i].tries > 1) {","            arrow.className = \"up\";","        }","        question.appendChild(arrow);","        var aTag = document.createElement(\"a\");","        aTag.href = \"#\";","        aTag.appendChild(question);","        aTag.onclick = function(e){","            e.preventDefault();","            var sibling = this.parentNode.querySelector(\".answer\");","","            sibling.classList.toggle(\"hidden\");","            this.parentNode.querySelector(\"img\").classList.toggle(\"up\");","        };","        container.appendChild(aTag);","","        var answer = document.createElement(\"section\");","        answer.classList.add(\"answer\");","        if(!container.classList.contains(\"incorrect\") && this.questionsArr[i].tries == 1) {","            answer.classList.add(\"hidden\");","","        }","        answer.innerHTML = \"Du svarade: \" + this.questionsArr[i].answer;","        if(this.questionsArr[i].tries > 1){","            answer.innerHTML += \" efter \" + this.questionsArr[i].tries + \" försök\"","        }","        container.appendChild(answer);","","        scoreBoard.appendChild(container);","    }","","    var total = document.createElement(\"div\");","    total.innerHTML = \"Du fick \" + score + \" av \" + this.questionsArr.length + \" rätt!\";","    total.className = \"totalScore\";","    game.appendChild(total);","","    var newGame = document.createElement(\"button\");","    newGame.innerHTML = \"Ny omgång\";","    newGame.className = \"btn newGame\";","    newGame.onclick = function(){","        that.init();","    };","    game.appendChild(newGame);","","};","QuizWindow.prototype.disableInput   = function(){","    var button = this.app.querySelector(\".sendAnswer\");","    var text = this.app.querySelector(\".answerBox\");","","    text.readOnly = true;","    button.disabled = true;","};","QuizWindow.prototype.enableInput    = function(){","    var button = this.app.querySelector(\".sendAnswer\");","    var text = this.app.querySelector(\".answerBox\");","","    text.readOnly = false;","    button.disabled = false;","};","QuizWindow.prototype.getQuestion    = function(url){","    var that = this;","","    var handleMessage = function(jsonObj){","        var obj = JSON.parse(jsonObj);","        that.nextURL = obj.nextURL;","        var questionField = that.app.querySelector(\".questionField\");","        questionField.classList.toggle(\"opacity-0\");","        setTimeout(function(){","            questionField.innerHTML = obj.question;","","            questionField.classList.toggle(\"opacity-0\");","        }, 250);","","        that.addQuestion(obj.question);","        that.enableInput();","        that.setStatus(\"Waiting on input...\");","    };","    that.setStatus(\"Waiting on question from server\");","    new AjaxCon(url, handleMessage, \"GET\");","};","QuizWindow.prototype.sendAnswer     = function(answerInput){","    var that = this;","","    that.addAnswer(answerInput);","","    var handleMessage = function(jsonObj){","","        var obj = JSON.parse(jsonObj);","        that.addResponse(obj.message);","","        if(obj.nextURL != undefined){","            that.getQuestion(obj.nextURL);","        }else if(obj.message === \"Wrong answer! :(\"){","            that.enableInput();","            that.addFailure();","            that.setStatus(\"Waiting on input...\");","        }","        else{","            that.gameOver();","            that.setStatus(\"No more questions!\");","        }","    };","    var url = this.nextURL;","","    this.setStatus(\"Sending answer to server\");","    new AjaxCon(url, handleMessage, \"POST\", JSON.stringify({answer: answerInput}));","","};","QuizWindow.prototype.init           = function(){","    this.questionsArr = [];","    this.render();","    this.getQuestion(\"http://vhost3.lnu.se:20080/question/1\");","};","QuizWindow.prototype.gameOver       = function(){","    this.getScore();","};","QuizWindow.prototype.render         = function(){","    var that = this;","    this.app.innerHTML = '';","    this.app.classList.add(\"thequiz\");","    var questionDiv = document.createElement(\"div\");","    questionDiv.className = \"workArea\";","","    var questionField = document.createElement(\"div\");","    questionField.className = \"questionField\";","    questionDiv.appendChild(questionField);","","    var input = document.createElement(\"input\");","    input.type = \"text\";","    input.className = \"answerBox\";","    questionDiv.appendChild(input);","","    var button = document.createElement(\"button\");","    button.className = \"sendAnswer\";","    button.innerHTML = \"Skicka svar\";","    var submitForm = function(e){","        if(input.value != \"\"){","            that.disableInput();","            that.sendAnswer(input.value);","            input.value = \"\";","        }","    };","    button.onclick = submitForm;","    input.onkeypress = function(e){","        if(e.keyCode == 13) {","            submitForm();","        }","    };","    questionDiv.appendChild(button);","","    this.app.appendChild(questionDiv);","};","QuizWindow.prototype.addAnswer      = function(message){","    this.questionsArr[this.questionsArr.length - 1].answer = message;","};","QuizWindow.prototype.addResponse    = function(message){","    this.questionsArr[this.questionsArr.length - 1].response = message;","};","QuizWindow.prototype.addQuestion    = function(message){","","    this.questionsArr.push({","        question: message,","        answer: undefined,","        response: undefined,","        tries: 1","    });","};","QuizWindow.prototype.error          = function(message){","    this.app.innerHTML = \"<p>Någonting gick fel!</p><p>Testa att starta om applikationen</p>\";","};","QuizWindow.prototype.addFailure     = function(){","    this.questionsArr[this.questionsArr.length - 1].tries++;","    var pTag = document.createElement(\"p\");","    pTag.innerHTML = \"Fel svar, försök igen!\";","    this.app.querySelector(\".questionField\").appendChild(pTag);","};","/**"," * Created by Erik."," */","\"use strict\";","","QuoteWindow.prototype = new Window();","QuoteWindow.prototype.constructor = QuoteWindow;","function QuoteWindow(self, xPos, yPos) {","    this.WindowConstruct(\"Quote\", false, self, xPos, yPos);","","    this.timer;","    this.connection;","    this.refreshRate = 10000;","","    this.render();","}","QuoteWindow.prototype.render        = function(){","    var self = this;","    self.app.classList.add(\"Quote\");","    var timer;","","    var refresh = function(){","        var handler = function(response){","            clearTimeout(timer);","            self.setStatus(\"\");","            var obj = JSON.parse(response);","","            self.app.innerHTML = \"\";","","            if (typeof obj.Url !== \"undefined\") {","                var image = document.createElement(\"img\");","                image.src = obj.Url;","","                setTimeout(function () {","                    image.classList.add(\"active\");","","                    setTimeout(function () {","                        image.classList.remove(\"active\");","                    }, self.refreshRate - 500);","                }, 250);","","                self.app.appendChild(image);","            }","","            var quote = document.createElement(\"blockquote\");","            quote.innerHTML = obj.Quote.replace(/\\r\\n/g, '<br/><br/>');","            self.app.appendChild(quote);","            setTimeout(function(){","                quote.classList.add(\"active\");","","                setTimeout(function(){","                    quote.classList.remove(\"active\");","                },self.refreshRate - 500);","            },250);","","            var author = document.createElement(\"cite\");","            author.innerHTML = obj.Author;","            quote.appendChild(author);","","            getQuote();","        };","","        self.setStatus(\"Loading quote from server...\");","        timer = setTimeout(function(){self.setStatus(\"Laddar... <img src='images/loader_white.gif'/>\");}, 300);","        self.connection = new AjaxCon(\"http://erikhamrin.se/projects/quotes.php\", handler, \"GET\");","    };","    var getQuote = function (){","        self.timer = setTimeout(refresh, self.refreshRate);","    };","    refresh();","};","QuoteWindow.prototype.ClearTimers   = function(){","    console.log(\"QUOTE: Removing all timers\");","    clearTimeout(this.timer);","","    console.log(\"QUOTE: Removing connection\");","    this.connection.abort();","};","/**"," * Created by Erik."," */","\"use strict\";","","RSSWindow.prototype = new Window();","RSSWindow.prototype.constructor = RSSWindow;","function RSSWindow(self, xPos, yPos) {","    this.startHeight = 600;","    this.startWidth = 300;","    this.WindowConstruct(\"RSS\", true, self, xPos, yPos);","","    this.feedUrl = \"http://www.dn.se/m/rss/senaste-nytt\";","    this.feed = undefined;","    this.timer = undefined;","    this.connection = undefined;","    this.refreshRate = 600000;","    this.reloadFeed();","    this.render();","}","RSSWindow.prototype.reloadFeed          = function(){","    var self = this;","","    var ajaxCall = function(){","        var handler = function(response){","            var date = new Date();","            var minute = (date.getMinutes() < 10) ? \"0\" + date.getMinutes() : date.getMinutes();","            var seconds = (date.getSeconds() < 10) ? \"0\" + date.getSeconds() : date.getSeconds();","            self.setStatus(\"Uppdaterad \" + date.getHours() + \":\" + minute + \":\" + seconds);","            self.feed.innerHTML = response;","        };","        self.setStatus(\"Laddar RSS-flöde\");","        self.connection = new AjaxCon(\"http://homepage.lnu.se/staff/tstjo/labbyServer/rssproxy/?url=\" + encodeURI(self.feedUrl), handler, \"GET\");","","    };","","    ajaxCall();","    this.timer = setInterval(ajaxCall, self.refreshRate);","};","RSSWindow.prototype.render              = function(){","    var self = this;","    self.app.className = \"RSSWindow\";","","    self.feed = document.createElement(\"article\");","    self.app.appendChild(self.feed);","};","RSSWindow.prototype.ClearTimers         = function(){","    console.log(\"RSS: Removing all timers\");","    clearInterval(this.timer);","};","RSSWindow.prototype.contextMenu         = function(){","    var that = this;","","    var option1 = document.createElement(\"ul\");","    option1.dataset.name = \"Settings\";","","    var level = document.createElement(\"li\");","    var aTag = document.createElement(\"a\");","    aTag.href = \"#\";","    aTag.innerHTML = \"<img src='images/interval.png'> Timer interval\";","    aTag.onclick = function(e){","        e.preventDefault();","        that.getIntervalSetting();","    };","    level.appendChild(aTag);","    option1.appendChild(level);","","    level = document.createElement(\"li\");","    aTag = document.createElement(\"a\");","    aTag.href = \"#\";","    aTag.innerHTML = \"<img src='images/setting.png'> Select RSS-feed\";","    aTag.onclick = function(e){","        e.preventDefault();","        that.getRSSFeed();","    };","    level.appendChild(aTag);","    option1.appendChild(level);","","    level = document.createElement(\"li\");","    aTag = document.createElement(\"a\");","    aTag.href = \"#\";","    aTag.innerHTML = \"<img src='images/refresh.png'> Refresh\";","    aTag.onclick = function(e){","        e.preventDefault();","        that.ClearTimers();","        that.reloadFeed();","    };","    level.appendChild(aTag);","    option1.appendChild(level);","","    return [option1];","};","RSSWindow.prototype.getIntervalSetting  = function(){","    var self = this;","","    var popup = document.createElement(\"div\");","    popup.classList.add(\"popup\");","","    var close = document.createElement(\"a\");","    close.href = \"#\";","    var closeImg = document.createElement(\"img\");","    closeImg.src = \"images/closewindow.png\";","    close.appendChild(closeImg);","    close.onclick = function(e){","        e.preventDefault();","        self.app.removeChild(popup);","    };","    popup.appendChild(close);","","    var input = document.createElement(\"select\");","    var rates = [[10000, \"10 sekunder\"], [15000, \"15 sekunder\"], [30000, \"30 sekunder\"], [60000, \"1 minut\"], [300000, \"5 minuter\"], [600000, \"10 minuter\"], [1800000, \"30 minuter\"]];","    input.innerHTML = \"\";","    rates.forEach(function(rate){","        var selected = (rate[0] == self.refreshRate) ? \" selected\" : \"\";","        input.innerHTML += \"<option value='\" + rate[0] + \"'\" + selected + \">\" + rate[1] + \"</option>\";","    });","","    popup.appendChild(input);","","    var submit = document.createElement(\"button\");","    submit.innerHTML = \"Ändra\";","    submit.onclick = function(){","        self.ClearTimers();","        self.refreshRate = input.value;","        self.reloadFeed();","        self.app.removeChild(popup);","    };","    popup.appendChild(submit);","","    this.app.appendChild(popup);","};","RSSWindow.prototype.getRSSFeed          = function(){","    var self = this;","","    var popup = document.createElement(\"div\");","    popup.classList.add(\"popup\");","","    var close = document.createElement(\"a\");","    close.href = \"#\";","    var closeImg = document.createElement(\"img\");","    closeImg.src = \"images/closewindow.png\";","    close.appendChild(closeImg);","    close.onclick = function(e){","        e.preventDefault();","        self.app.removeChild(popup);","    };","    popup.appendChild(close);","","    var inputContainer = document.createElement(\"div\");","    inputContainer.classList.add(\"inputcontainer\");","","    var input = document.createElement(\"input\");","    input.type = \"radio\";","    input.name = \"rssRadio\";","    input.value = \"http://www.dn.se/m/rss/senaste-nytt\";","    var radioText = document.createTextNode(\"DN - Senaste nytt\");","    inputContainer.appendChild(input);","    inputContainer.appendChild(radioText);","    popup.appendChild(inputContainer);","","    inputContainer = document.createElement(\"div\");","    inputContainer.classList.add(\"inputcontainer\");","    input = document.createElement(\"input\");","    input.type = \"radio\";","    input.name = \"rssRadio\";","    input.value = \"http://www.dn.se/ledare/m/rss\";","    radioText = document.createTextNode(\"DN - Ledare\");","    inputContainer.appendChild(input);","    inputContainer.appendChild(radioText);","    popup.appendChild(inputContainer);","","    inputContainer = document.createElement(\"div\");","    inputContainer.classList.add(\"inputcontainer\");","    input = document.createElement(\"input\");","    input.type = \"radio\";","    input.name = \"rssRadio\";","    input.value = \"http://www.dn.se/ekonomi/m/rss/senaste-nytt\";","    radioText = document.createTextNode(\"DN - Ekonomi\");","    inputContainer.appendChild(input);","    inputContainer.appendChild(radioText);","    popup.appendChild(inputContainer);","","    inputContainer = document.createElement(\"div\");","    inputContainer.classList.add(\"inputcontainer\");","    input = document.createElement(\"input\");","    input.type = \"radio\";","    input.name = \"rssRadio\";","    input.value = \"other\";","    input.checked = true;","    radioText = document.createTextNode(\"Annat: \");","    inputContainer.appendChild(input);","    inputContainer.appendChild(radioText);","    popup.appendChild(inputContainer);","    input.onfocus = function(){","        textinput.focus();","        textinput.select();","    };","","","    var textinput = document.createElement(\"input\");","    textinput.type = \"text\";","    textinput.value = self.feedUrl;","    inputContainer.appendChild(textinput);","","    var submit = document.createElement(\"button\");","    submit.innerHTML = \"Skicka\";","    submit.onclick = function(){","        var value = popup.querySelector('input[name=\"rssRadio\"]:checked').value;","        if(value === \"other\"){","            self.feedUrl = textinput.value;","        }else{","            self.feedUrl = value;","        }","        self.ClearTimers();","        self.reloadFeed();","        self.app.removeChild(popup);","    };","    popup.appendChild(submit);","","    this.app.appendChild(popup);","    textinput.focus();","    textinput.select();","};","","\"use strict\";","function Window(){","    this.dragY = 0;","    this.dragX = 0;","    this.dragging = false;","    this.imageFolder = \"images/\";","}","Window.prototype.focusWindow        = function(){","    var allApps = document.querySelectorAll(\".application\");","    for(var i = 0; i < allApps.length; i++){","        allApps[i].style.zIndex = \"1\";","    }","    this.style.zIndex = \"5\";","};","Window.prototype.createHTML         = function(){","    var self = this;","    var divApp = document.createElement(\"div\");","    divApp.classList.add(\"application\");","    divApp.style.left = this.xPos + \"px\";","    divApp.style.top = this.yPos + \"px\";","    divApp.style.zIndex = \"6\";","    if(this.startWidth !== undefined){","        divApp.style.width = this.startWidth + \"px\";","    }","    if(this.startHeight !== undefined){","        divApp.style.height = this.startHeight + \"px\";","    }","","    divApp.onmousedown = this.focusWindow;","","    var header = document.createElement(\"header\");","    header.classList.add(\"appHeader\");","    header.onmousedown = function(e){","        if(!divApp.classList.contains(\"fullscreen\") && e.target != closeWindow && e.target != fullsize && e.target != minimizewindow){","            self.dragY = (e.pageY - divApp.offsetTop);","            self.dragX = (e.pageX - divApp.offsetLeft);","            header.style.cursor = \"move\";","            self.dragging = true;","            divApp.classList.add(\"dragging\");","            self.DisableSelection(self.desktop.element);","            header.addEventListener(\"mouseleave\", disableDragging);","            header.addEventListener(\"mousemove\", function(e){","                if (self.dragging) {","                    divApp.style.top = (e.clientY - self.dragY)  + \"px\";","                    divApp.style.left = (e.clientX - self.dragX) + \"px\";","                }","            });","        }","    };","    var disableDragging = function(e){","        if((e.clientY - self.dragY + 200) > window.innerHeight) {","            divApp.style.top = (window.innerHeight - 200) + \"px\";","        }else if(e.clientY - self.dragY < 0){","            divApp.style.top = \"20px\";","        }","","        if((e.clientX - self.dragX + 200) > window.innerWidth) {","            divApp.style.left = (window.innerWidth - 200) + \"px\";","        }else if(e.clientX - self.dragX < 0){","            divApp.style.left = \"20px\";","        }","","        self.dragging = false;","        divApp.classList.remove(\"dragging\");","        header.style.removeProperty(\"cursor\");","        self.EnableSelection(self.desktop.element);","    };","    header.onmouseup = disableDragging;","","","","    var appIcon = document.createElement(\"img\");","    appIcon.src = this.imageFolder + \"appIcons/\" + this.type + \".png\";","    appIcon.alt = \"Icon\";","    appIcon.ondragstart = function() { return false; };","    appIcon.classList.add(\"appIcon\");","    header.appendChild(appIcon);","","    var title = document.createElement(\"h2\");","    title.innerHTML = this.type;","    header.appendChild(title);","","    var closeWindow = document.createElement(\"img\");","    closeWindow.classList.add(\"appController\");","    closeWindow.alt = \"Close window\";","    closeWindow.src = this.imageFolder + \"closewindow.png\";","    closeWindow.onclick = function(){","        if(typeof self.ClearTimers == \"function\"){","            self.ClearTimers();","        }","        document.querySelector(\"#desktopApplication\").removeChild(divApp);","    };","    header.appendChild(closeWindow);","","    var fullsize = document.createElement(\"img\");","    fullsize.classList.add(\"appController\");","    fullsize.alt = \"Fullscreen\";","    fullsize.src = this.imageFolder + \"fullsize.png\";","    fullsize.onclick = function(e){","        if(divApp.classList.contains(\"fullscreen\")){","            divApp.style.left = self.xPos + \"px\";","            divApp.style.top = self.yPos + \"px\";","            if(self.startWidth !== undefined){","                divApp.style.width = self.startWidth + \"px\";","            }","            if(self.startHeight !== undefined){","                divApp.style.height = self.startHeight + \"px\";","            }","        }else{","            self.xPos = divApp.offsetLeft;","            self.yPos = divApp.offsetTop;","            divApp.style.removeProperty('width');","            divApp.style.removeProperty('height');","            divApp.style.removeProperty('top');","            divApp.style.removeProperty('left');","        }","        divApp.classList.toggle(\"fullscreen\");","    };","    header.appendChild(fullsize);","","    var minimizewindow = document.createElement(\"img\");","    minimizewindow.classList.add(\"appController\");","    minimizewindow.alt = \"Minimize\";","    minimizewindow.src = this.imageFolder + \"minimizewindow.png\";","    minimizewindow.onclick = function(){","        self.desktop.hideApp(this, self.imageFolder + \"appIcons/\" + self.type + \"_Large.png\");","    };","    header.appendChild(minimizewindow);","","","    divApp.appendChild(header);","","    var main = document.createElement(\"main\");","","    if(typeof this.contextMenu !== \"undefined\"){","        var Menu = document.createElement(\"div\");","        Menu.classList.add(\"Menu\");","        this.contextMenu().forEach(function(menu){","            var contextMenu = menu;","            contextMenu.classList.add(\"hide\");","","            var Options = document.createElement(\"ul\");","            Options.classList.add(\"contextMenu\");","            var menuOptions = document.createElement(\"a\");","            menuOptions.href = \"#\";","            menuOptions.innerHTML = contextMenu.dataset.name;","","            var hideFunction = function(){","                contextMenu.classList.add(\"hide\");","                document.documentElement.removeEventListener('mouseup', hideFunction, false);","            };","","            menuOptions.onclick = function(e){","                e.preventDefault();","                contextMenu.classList.remove(\"hide\");","                document.documentElement.addEventListener('mouseup', hideFunction, false);","            };","            contextMenu.onclick = hideFunction;","","            Menu.appendChild(Options);","            Options.appendChild(menuOptions);","            Options.appendChild(contextMenu);","        });","        main.appendChild(Menu);","    }","    this.app = document.createElement(\"div\");","    main.appendChild(this.app);","    divApp.appendChild(main);","","    self.statusBar = document.createElement(\"footer\");","    self.statusBar.classList.add(\"statusBar\");","","    divApp.appendChild(self.statusBar);","","    if(this.resizable) {","        var startX, startY, startWidth, startHeight;","        var initDrag = function(e) {","            startX = e.clientX;","            startY = e.clientY;","            startWidth = parseInt(document.defaultView.getComputedStyle(divApp).width, 10);","            startHeight = parseInt(document.defaultView.getComputedStyle(divApp).height, 10);","            document.documentElement.addEventListener('mousemove', doDrag, false);","            document.documentElement.addEventListener('mouseup', stopDrag, false);","        };","        var doDrag = function(e) {","            if((startWidth + e.clientX - startX) < window.innerWidth - 300) {","                divApp.style.minWidth = (startWidth + e.clientX - startX) + 'px';","            }","            if((startHeight + e.clientY - startY) < window.innerHeight - 200 ){","                divApp.style.minHeight = (startHeight + e.clientY - startY) + 'px';","            }","        };","        var stopDrag = function() {","            document.documentElement.removeEventListener('mousemove', doDrag, false);","            document.documentElement.removeEventListener('mouseup', stopDrag, false);","        };","","        var resize = document.createElement(\"img\");","        resize.alt = \"Resize\";","        resize.src = this.imageFolder + \"resize.png\";","        resize.className = \"resize noselect\";","        resize.ondragstart = function() { return false; };","        resize.addEventListener('mousedown', initDrag, false);","","        divApp.appendChild(resize);","    }","    document.querySelector(\"#desktopApplication\").appendChild(divApp);","","};","Window.prototype.setStatus          = function(message){","    this.statusBar.innerHTML = message;","};","Window.prototype.WindowConstruct    = function(type, resizable, self, xPos, yPos){","    this.resizable = resizable;","    this.desktop = self;","    this.xPos = xPos;","    this.yPos = yPos;","    this.type = type;","    this.createHTML();","};","Window.prototype.DisableSelection   = function(element){","    element.onselectstart = function() {return false;};","    element.unselectable = \"on\";","    element.style.MozUserSelect = \"none\";","    element.style.cursor = \"default\";","};","Window.prototype.EnableSelection    = function(element){","    element.onselectstart = function() {return true;};","    element.unselectable = \"off\";","    element.style.MozUserSelect = \"text\";","    element.style.cursor = \"auto\";","};","/**"," * Created by Erik."," */","\"use strict\";","window.onload = function(){","    new AppLoader(\"Loading your desktop...\");","    new Desktop(\"desktopApplication\");","};"]}]}],[{"group":"doc","deltas":[{"start":{"row":47,"column":2},"end":{"row":77,"column":1},"action":"remove","lines":["","/**"," * Created by Erik."," */","\"use strict\";","function AppLoader(header){","    var background = document.createElement(\"div\");","    background.classList.add(\"AppLoader\");","","    var h1 = document.createElement(\"h1\");","    h1.innerHTML = header;","    background.appendChild(h1);","","    var body = document.querySelector(\"body\");","    body.appendChild(background);","","    var container = document.createElement(\"div\");","    container.classList.add(\"container\");","    background.appendChild(container);","","    var progress = document.createElement(\"div\");","    progress.classList.add(\"progress\");","    container.appendChild(progress);","    setTimeout(function(){","        progress.classList.add(\"loading\");","","        setTimeout(function(){","            body.removeChild(background);","        }, 1250);","    }, 200);","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":1969,"column":17},"end":{"row":1969,"column":35},"action":"remove","lines":["desktopApplication"]},{"start":{"row":1969,"column":17},"end":{"row":1969,"column":18},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":1969,"column":18},"end":{"row":1969,"column":19},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":1969,"column":19},"end":{"row":1969,"column":20},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":1969,"column":20},"end":{"row":1969,"column":21},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":1969,"column":21},"end":{"row":1969,"column":22},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":1969,"column":22},"end":{"row":1969,"column":23},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":1969,"column":23},"end":{"row":1969,"column":24},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":1937,"column":29},"end":{"row":1937,"column":47},"action":"remove","lines":["desktopApplication"]},{"start":{"row":1937,"column":29},"end":{"row":1937,"column":30},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":1937,"column":30},"end":{"row":1937,"column":31},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":1937,"column":31},"end":{"row":1937,"column":32},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":1937,"column":32},"end":{"row":1937,"column":33},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":1937,"column":33},"end":{"row":1937,"column":34},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":1937,"column":34},"end":{"row":1937,"column":35},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":1937,"column":35},"end":{"row":1937,"column":36},"action":"insert","lines":["t"]}]}]]},"ace":{"folds":[],"scrolltop":32852,"scrollleft":0,"selection":{"start":{"row":1953,"column":31},"end":{"row":1953,"column":31},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1419090166023,"hash":"df9f1b733de80f485067a317a8ce78bd3b122caf"}